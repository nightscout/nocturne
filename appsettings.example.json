{
  "ConnectionStrings": {
    // Used only when PostgreSql.UseRemoteDatabase is true
    "nocturne-postgres": "Host=localhost;Port=5432;Database=nocturne;Username=nocturne_user;Password=nocturne_password"
  },
  "Parameters": {
    "postgres-username": "nocturne_user",
    "postgres-password": "nocturne_password",
    "postgres-database": "nocturne",
    "api-secret": "",
    "Connectors": {
      "Dexcom": {
        "Enabled": false,
        "Username": "",
        "Password": "",
        "Region": "us",
        "Server": "share2.dexcom.com",
        "SyncIntervalMinutes": 5
      },
      "Glooko": {
        "Enabled": false,
        "Email": "",
        "Password": "",
        "Server": "api.glooko.com",
        "TimezoneOffset": 0,
        "SyncIntervalMinutes": 5
      },
      "LibreLinkUp": {
        "Enabled": false,
        "Username": "",
        "Password": "",
        "Region": "US",
        "PatientId": "",
        "Server": "",
        "SyncIntervalMinutes": 5
      },
      "CareLink": {
        "Enabled": false,
        "Username": "",
        "Password": "",
        "Region": "us",
        "CountryCode": "US",
        "PatientUsername": "",
        "SyncIntervalMinutes": 5
      },
      "Nightscout": {
        "Enabled": false,
        "SourceEndpoint": "",
        "SourceApiSecret": "",
        "SubjectToken": "", // v3 API
        "SyncIntervalMinutes": 5
      },
      "MyFitnessPal": {
        "Enabled": false,
        "Username": "",
        "Password": "",
        "SyncDays": 7,
        "SyncIntervalMinutes": 5
      },
      "MyLife": {
        "Enabled": false,
        "Username": "",
        "Password": "",
        "PatientId": "",
        "ServiceUrl": "",
        "EnableGlucoseSync": true,
        "EnableManualBgSync": true,
        "EnableMealCarbConsolidation": true,
        "EnableTempBasalConsolidation": true,
        "TempBasalConsolidationWindowMinutes": 5,
        "AppPlatform": 2,
        "AppVersion": 20403,
        "SyncMonths": 6,
        "SyncIntervalMinutes": 5
      },
      "TConnectSync": {
         "Email": "email@example.com",
         "Password": "password",
         "Region": "US"
      }
    },

    "CompatibilityProxy": {
      "Enabled": false,
      "NightscoutUrl": "",
      "NightscoutApiSecret": "",
      "TimeoutSeconds": 30,
      "RetryAttempts": 3,
      "DefaultStrategy": "Nightscout",
      "EnableDetailedLogging": false,
      "Redaction": {
        "Enabled": true,
        "SensitiveFields": ["api_secret", "token", "password", "key", "secret", "authorization"],
        "ReplacementText": "[REDACTED]",
        "RedactUrlParameters": true,
        "UrlParametersToRedact": ["token", "api_secret", "secret", "key"]
      },
      "DiscrepancyForwarding": {
        "Enabled": false,
        "SaveRawData": false,
        "DataDirectory": "discrepancies",
        "EndpointUrl": "https://monitor.nocturne.example.com",
        "ApiKey": "your-api-key",
        "SourceId": "my-instance",
        "MinimumSeverity": "Minor",
        "TimeoutSeconds": 10,
        "RetryAttempts": 3,
        "RetryDelayMs": 1000
      },
      "Comparison": {
        "ExcludeFields": ["timestamp", "date", "dateString", "_id", "id", "sysTime", "mills", "created_at", "updated_at"],
        "AllowSupersetResponses": true,
        "TimestampToleranceMs": 5000,
        "NumericPrecisionTolerance": 0.001,
        "NormalizeFieldOrdering": true,
        "ArrayOrderHandling": "Strict",
        "EnableDeepComparison": true
      },
      "CircuitBreaker": {
        "FailureThreshold": 5,
        "RecoveryTimeoutSeconds": 60,
        "SuccessThreshold": 3
      }
    },
    "DemoMode": {
      "Enabled": false,
      "ClearOnStartup": true,
      "RegenerateOnStartup": true,
      "BackfillDays": 90,
      "IntervalMinutes": 5,
      "TargetGlucose": 110.0,
      "InsulinSensitivityFactor": 40.0,
      "CarbRatio": 10.0,
      "BasalRate": 1.0,
      "InsulinDurationMinutes": 240.0,
      "InsulinPeakMinutes": 75.0,
      "TempBasalDurationMinutes": 10,
      "MinGlucose": 70,
      "MaxGlucose": 250,
      "Device": "demo-cgm"
    }
  },
  "WebSocket": {
    "ReconnectAttempts": 5,
    "MaxReconnectDelay": 30000,
    "ReconnectDelay": 1000,
    "PingTimeout": 15000,
    "PingInterval": 20000
  },
  "PostgreSql": {
    "UseRemoteDatabase": false, // if true, uses ConnectionStrings.nocturne-postgres; if false, Aspire manages local container
    "EnableSensitiveDataLogging": false,
    "EnableDetailedErrors": false,
    "MaxRetryCount": 3,
    "MaxRetryDelaySeconds": 30,
    "CommandTimeoutSeconds": 30
  },
  "Logging": {
    "LogLevel": {
      "Default": "Information",
      "Microsoft.AspNetCore": "Warning",
      "Microsoft.Hosting.Lifetime": "Information",
      "Microsoft.Extensions.Hosting": "Information",
      "Yarp": "Information",
      "Nocturne": "Information"
    },
    "Console": {
      "IncludeScopes": false,
      "LogLevel": {
        "Default": "Information"
      }
    }
  },
  "Jwt": {
    "SecretKey": "YourJWTSecretKeyShouldBeAtLeast32CharactersLongForSecurityReasons",
    "Issuer": "nocturne",
    "Audience": "nocturne-api",
    "AccessTokenLifetimeMinutes": 15,
    "RefreshTokenLifetimeDays": 7,
    "RefreshTokenLengthBytes": 64
  },
  "Oidc": {
    "Enabled": false,
    "BaseUrl": "https://your-nocturne-instance.example.com",
    "DefaultReturnUrl": "/",
    "RequireHttpsRedirect": true,
    "AutoCreateSubjects": true,
    "AllowedReturnUrlPatterns": [],
    "Session": {
      "AccessTokenLifetime": "00:15:00",
      "RefreshTokenLifetime": "7.00:00:00",
      "SlidingRefreshExpiration": true,
      "MaxRefreshTokenLifetime": "30.00:00:00",
      "RotateRefreshTokens": true,
      "IdleTimeout": "08:00:00"
    },
    "Cookie": {
      "Name": ".Nocturne.Session",
      "StateCookieName": ".Nocturne.OidcState",
      "AccessTokenName": ".Nocturne.AccessToken",
      "RefreshTokenName": ".Nocturne.RefreshToken",
      "Domain": null,
      "Path": "/",
      "Secure": true, // setting to true makes it require requests come from https
      "HttpOnly": true,
      "SameSite": "Lax",
      "Expiration": null
    },
    "State": {
      "Lifetime": "00:15:00",
      "IncludeNonce": true
    }
  },
  "LocalIdentity": {
    "Enabled": true,
    "DisplayName": "Nocturne",
    "Registration": {
      "AllowRegistration": true,
      "RequireEmailVerification": true,
      "RequireAdminApproval": false,
      "DefaultRoles": ["readable"]
    },
    "Allowlist": {
      "Enabled": false,
      "AllowedEmails": [],
      "AllowedDomains": [],
      "AllowOthersWithApproval": false
    },
    "Password": {
      "MinLength": 12,
      "MaxLength": 128,
      "RequireUppercase": false,
      "RequireLowercase": false,
      "RequireDigit": false,
      "RequireSpecialCharacter": false
    },
    "Lockout": {
      "Enabled": true,
      "MaxFailedAttempts": 5,
      "LockoutDurationMinutes": 5,
      "ExponentialBackoff": true,
      "MaxLockoutDurationMinutes": 60
    },
    "Tokens": {
      "EmailVerificationTokenHours": 24,
      "PasswordResetTokenHours": 1
    },
    // Optional: Seed user accounts on startup
    // These accounts are created automatically if they don't exist
    // Remove or leave empty in production after initial setup
    "SeedUsers": [
      // {
      //   "Email": "admin@example.com",
      //   "Password": "your-secure-password",
      //   "DisplayName": "Admin",
      //   "IsAdmin": true
      // },
      // {
      //   "Email": "caregiver@example.com",
      //   "Password": "your-secure-password",
      //   "DisplayName": "Caregiver",
      //   "Roles": ["readable", "caregiver"]
      // }
    ]
  },
  // Email configuration (separate from LocalIdentity for other notifications)
  "Email": {
    "Enabled": false,
    "SmtpHost": "",
    "SmtpPort": 587,
    "UseSsl": true,
    "SmtpUsername": "",
    "SmtpPassword": "",
    "FromAddress": "noreply@example.com",
    "FromName": "Nocturne",
    "AdminEmail": "admin@example.com",
    "BaseUrl": "https://your-nocturne-instance.example.com"
  },
  "AllowedHosts": "*",
  "ApiSettings": {
    "DefaultPageSize": 50,
    "MaxPageSize": 1000,
    "EnableSwagger": true,
    "EnableCors": true,
    "RateLimiting": {
      "Enabled": false,
      "RequestsPerMinute": 100
    }
  },
  "NightscoutSettings": {
    "ApiSecret": "your-nightscout-api-secret",
    "BaseUrl": "https://your-nightscout-instance.herokuapp.com",
    "DefaultUnits": "mg/dl",
    "TimeFormat": 12,
    "Language": "en",
    "Theme": "default",
    "ShowPlugins": ["delta", "direction", "timeago", "devicestatus"],
    "Alarms": {
      "UrgentHigh": {
        "Enabled": true,
        "Threshold": 400,
        "Minutes": [15, 30, 60]
      },
      "High": {
        "Enabled": true,
        "Threshold": 260,
        "Minutes": [30, 60]
      },
      "Low": {
        "Enabled": true,
        "Threshold": 55,
        "Minutes": [15, 30, 45, 60]
      },
      "UrgentLow": {
        "Enabled": true,
        "Threshold": 39,
        "Minutes": [5, 10, 15, 30]
      }
    },
    "Thresholds": {
      "High": 260,
      "TargetTop": 180,
      "TargetBottom": 80,
      "Low": 55
    }
  },
  "NotificationSettings": {
    "Pushover": {
      "Enabled": false,
      "ApiToken": "your-pushover-api-token",
      "UserKey": "your-pushover-user-key",
      "Sounds": {
        "WARN": "default",
        "URGENT": "siren",
        "INFO": "none"
      }
    }
    // Email notifications use the root-level "Email" configuration section
  },
  "HealthChecks": {
    "Enabled": true,
    "DetailedErrors": false,
    "Checks": {
      "Database": {
        "Enabled": true,
        "Timeout": "00:00:30"
      }
    }
  },
  "OpenTelemetry": {
    "ServiceName": "Nocturne",
    "ServiceVersion": "1.0.0",
    "Tracing": {
      "Enabled": false,
      "Exporters": ["console", "otlp"],
      "OtlpEndpoint": "http://localhost:4317"
    },
    "Metrics": {
      "Enabled": false,
      "Exporters": ["console", "otlp"]
    }
  }
}
