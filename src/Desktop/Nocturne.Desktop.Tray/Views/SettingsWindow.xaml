<?xml version="1.0" encoding="utf-8"?>
<Window
    x:Class="Nocturne.Desktop.Tray.Views.SettingsWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    Title="Settings">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <ScrollViewer Grid.Row="0" Padding="24,24,24,8">
            <StackPanel Spacing="24" MaxWidth="440" HorizontalAlignment="Stretch">

                <!-- Connection Section -->
                <StackPanel Spacing="8">
                    <TextBlock Text="Connection"
                               FontSize="14"
                               FontWeight="SemiBold"
                               Foreground="{ThemeResource TextFillColorSecondaryBrush}" />

                    <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                            BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                            BorderThickness="1"
                            CornerRadius="8"
                            Padding="16">
                        <StackPanel Spacing="16">
                            <TextBox
                                x:Name="ServerUrlBox"
                                Header="Server URL"
                                PlaceholderText="https://your-nocturne-instance.com" />

                            <Border Background="{ThemeResource CardBackgroundFillColorSecondaryBrush}"
                                    CornerRadius="6"
                                    Padding="12,10">
                                <Grid ColumnSpacing="12">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="Auto" />
                                    </Grid.ColumnDefinitions>

                                    <StackPanel Grid.Column="0" Orientation="Horizontal" Spacing="8" VerticalAlignment="Center">
                                        <Ellipse
                                            x:Name="AuthIndicator"
                                            Width="10"
                                            Height="10"
                                            Fill="{ThemeResource SystemFillColorCriticalBrush}" />
                                        <TextBlock
                                            x:Name="AuthStatusText"
                                            Text="Not signed in"
                                            FontSize="13"
                                            Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                            VerticalAlignment="Center" />
                                    </StackPanel>

                                    <Button
                                        x:Name="SignInOutButton"
                                        Grid.Column="1"
                                        Content="Sign In"
                                        Click="OnSignInOutClick"
                                        MinWidth="100" />
                                </Grid>
                            </Border>
                        </StackPanel>
                    </Border>
                </StackPanel>

                <!-- Display Section -->
                <StackPanel Spacing="8">
                    <TextBlock Text="Display"
                               FontSize="14"
                               FontWeight="SemiBold"
                               Foreground="{ThemeResource TextFillColorSecondaryBrush}" />

                    <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                            BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                            BorderThickness="1"
                            CornerRadius="8"
                            Padding="16">
                        <StackPanel Spacing="0">
                            <!-- Glucose Unit -->
                            <Grid MinHeight="40" Padding="0,4">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="Auto" />
                                </Grid.ColumnDefinitions>
                                <TextBlock Text="Glucose Unit"
                                           VerticalAlignment="Center"
                                           FontSize="14" />
                                <ComboBox
                                    x:Name="UnitCombo"
                                    Grid.Column="1"
                                    SelectedIndex="0"
                                    MinWidth="130">
                                    <ComboBoxItem Content="mg/dL" />
                                    <ComboBoxItem Content="mmol/L" />
                                </ComboBox>
                            </Grid>

                            <Rectangle Height="1"
                                       Fill="{ThemeResource DividerStrokeColorDefaultBrush}"
                                       Margin="-16,8" />

                            <!-- Chart Hours -->
                            <Grid MinHeight="40" Padding="0,4">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="Auto" />
                                </Grid.ColumnDefinitions>
                                <TextBlock Text="Chart Hours"
                                           VerticalAlignment="Center"
                                           FontSize="14" />
                                <NumberBox
                                    x:Name="ChartHoursBox"
                                    Grid.Column="1"
                                    Minimum="1"
                                    Maximum="12"
                                    Value="3"
                                    SpinButtonPlacementMode="Inline"
                                    MinWidth="140" />
                            </Grid>
                        </StackPanel>
                    </Border>
                </StackPanel>

                <!-- Thresholds Section -->
                <StackPanel Spacing="8">
                    <TextBlock x:Name="ThresholdHeader"
                               Text="Glucose Thresholds (mg/dL)"
                               FontSize="14"
                               FontWeight="SemiBold"
                               Foreground="{ThemeResource TextFillColorSecondaryBrush}" />

                    <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                            BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                            BorderThickness="1"
                            CornerRadius="8"
                            Padding="16">
                        <Grid ColumnSpacing="12" RowSpacing="12">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="*" />
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                            </Grid.RowDefinitions>

                            <NumberBox
                                x:Name="UrgentLowBox"
                                Grid.Row="0" Grid.Column="0"
                                Header="Urgent Low"
                                SpinButtonPlacementMode="Inline" />

                            <NumberBox
                                x:Name="LowBox"
                                Grid.Row="0" Grid.Column="1"
                                Header="Low"
                                SpinButtonPlacementMode="Inline" />

                            <NumberBox
                                x:Name="HighBox"
                                Grid.Row="1" Grid.Column="0"
                                Header="High"
                                SpinButtonPlacementMode="Inline" />

                            <NumberBox
                                x:Name="UrgentHighBox"
                                Grid.Row="1" Grid.Column="1"
                                Header="Urgent High"
                                SpinButtonPlacementMode="Inline" />
                        </Grid>
                    </Border>
                </StackPanel>

                <!-- Notifications Section -->
                <StackPanel Spacing="8">
                    <StackPanel Spacing="2">
                        <TextBlock Text="Alarm Notifications"
                                   FontSize="14"
                                   FontWeight="SemiBold"
                                   Foreground="{ThemeResource TextFillColorSecondaryBrush}" />
                        <TextBlock Text="Choose which server alarms show toast notifications"
                                   FontSize="12"
                                   Foreground="{ThemeResource TextFillColorTertiaryBrush}" />
                    </StackPanel>

                    <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                            BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                            BorderThickness="1"
                            CornerRadius="8"
                            Padding="16,12">
                        <StackPanel x:Name="AlarmTypesPanel" Spacing="4" />
                    </Border>
                </StackPanel>

                <!-- Bottom spacer for scroll breathing room -->
                <Border Height="8" />

            </StackPanel>
        </ScrollViewer>

        <!-- Sticky footer -->
        <Border Grid.Row="1"
                Background="{ThemeResource LayerFillColorDefaultBrush}"
                BorderBrush="{ThemeResource DividerStrokeColorDefaultBrush}"
                BorderThickness="0,1,0,0"
                Padding="24,16">
            <StackPanel Orientation="Horizontal" Spacing="8" HorizontalAlignment="Right">
                <Button
                    x:Name="CancelButton"
                    Content="Cancel"
                    Click="OnCancelClick"
                    MinWidth="100" />
                <Button
                    x:Name="SaveButton"
                    Content="Save"
                    Style="{ThemeResource AccentButtonStyle}"
                    Click="OnSaveClick"
                    MinWidth="100" />
            </StackPanel>
        </Border>
    </Grid>

</Window>
