// AUTO-GENERATED - DO NOT EDIT
// Generated by @nocturne/remote-function-codegen
// Source: openapi.json

import { getRequestEvent, query, command } from '$app/server';
import { error, redirect } from '@sveltejs/kit';
import { z } from 'zod';

/** Start a deduplication job to link related records from different data sources.
The job runs in the background and can be monitored using the status endpoint. */
export const startDeduplicationJob = command(async () => {
  const { locals } = getRequestEvent();
  const { apiClient } = locals;
  try {
    const result = await apiClient.deduplication.startDeduplicationJob();
    return result;
  } catch (err) {
    const status = (err as any)?.status;
    if (status === 401) { const { url } = getRequestEvent(); throw redirect(302, `/login?redirectTo=${encodeURIComponent(url.pathname + url.search)}`); }
    if (status === 403) throw error(403, 'Forbidden');
    console.error('Error in deduplication.startDeduplicationJob:', err);
    throw error(500, 'Failed to start deduplication job');
  }
});

/** Get the status of a deduplication job. */
export const getJobStatus = query(z.string(), async (jobId) => {
  const { locals } = getRequestEvent();
  const { apiClient } = locals;
  try {
    return await apiClient.deduplication.getJobStatus(jobId);
  } catch (err) {
    const status = (err as any)?.status;
    if (status === 401) { const { url } = getRequestEvent(); throw redirect(302, `/login?redirectTo=${encodeURIComponent(url.pathname + url.search)}`); }
    if (status === 403) throw error(403, 'Forbidden');
    console.error('Error in deduplication.getJobStatus:', err);
    throw error(500, 'Failed to get job status');
  }
});

/** Cancel a running deduplication job. */
export const cancelJob = command(z.string(), async (jobId) => {
  const { locals } = getRequestEvent();
  const { apiClient } = locals;
  try {
    const result = await apiClient.deduplication.cancelJob(jobId);
    return result;
  } catch (err) {
    const status = (err as any)?.status;
    if (status === 401) { const { url } = getRequestEvent(); throw redirect(302, `/login?redirectTo=${encodeURIComponent(url.pathname + url.search)}`); }
    if (status === 403) throw error(403, 'Forbidden');
    console.error('Error in deduplication.cancelJob:', err);
    throw error(500, 'Failed to cancel job');
  }
});

/** Get linked records for a specific entry by its canonical group. */
export const getEntryLinkedRecords = query(z.string(), async (entryId) => {
  const { locals } = getRequestEvent();
  const { apiClient } = locals;
  try {
    return await apiClient.deduplication.getEntryLinkedRecords(entryId);
  } catch (err) {
    const status = (err as any)?.status;
    if (status === 401) { const { url } = getRequestEvent(); throw redirect(302, `/login?redirectTo=${encodeURIComponent(url.pathname + url.search)}`); }
    if (status === 403) throw error(403, 'Forbidden');
    console.error('Error in deduplication.getEntryLinkedRecords:', err);
    throw error(500, 'Failed to get entry linked records');
  }
});

/** Get linked records for a specific treatment by its canonical group. */
export const getTreatmentLinkedRecords = query(z.string(), async (treatmentId) => {
  const { locals } = getRequestEvent();
  const { apiClient } = locals;
  try {
    return await apiClient.deduplication.getTreatmentLinkedRecords(treatmentId);
  } catch (err) {
    const status = (err as any)?.status;
    if (status === 401) { const { url } = getRequestEvent(); throw redirect(302, `/login?redirectTo=${encodeURIComponent(url.pathname + url.search)}`); }
    if (status === 403) throw error(403, 'Forbidden');
    console.error('Error in deduplication.getTreatmentLinkedRecords:', err);
    throw error(500, 'Failed to get treatment linked records');
  }
});

/** Get linked records for a specific state span by its canonical group. */
export const getStateSpanLinkedRecords = query(z.string(), async (stateSpanId) => {
  const { locals } = getRequestEvent();
  const { apiClient } = locals;
  try {
    return await apiClient.deduplication.getStateSpanLinkedRecords(stateSpanId);
  } catch (err) {
    const status = (err as any)?.status;
    if (status === 401) { const { url } = getRequestEvent(); throw redirect(302, `/login?redirectTo=${encodeURIComponent(url.pathname + url.search)}`); }
    if (status === 403) throw error(403, 'Forbidden');
    console.error('Error in deduplication.getStateSpanLinkedRecords:', err);
    throw error(500, 'Failed to get state span linked records');
  }
});
