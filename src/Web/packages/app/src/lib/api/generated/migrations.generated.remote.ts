// AUTO-GENERATED - DO NOT EDIT
// Generated by @nocturne/remote-function-codegen
// Source: openapi.json

import { getRequestEvent, query, command } from '$app/server';
import { error } from '@sveltejs/kit';
import { z } from 'zod';
import { TestMigrationConnectionRequestSchema, StartMigrationRequestSchema } from '$lib/api/generated/schemas';
import { type TestMigrationConnectionRequest, type StartMigrationRequest } from '$api';

/** Test a migration source connection */
export const testConnection = command(TestMigrationConnectionRequestSchema, async (request) => {
  const { locals } = getRequestEvent();
  const { apiClient } = locals;
  try {
    const result = await apiClient.migration.testConnection(request as TestMigrationConnectionRequest);
    return result;
  } catch (err) {
    console.error('Error in migration.testConnection:', err);
    throw error(500, 'Failed to test connection');
  }
});

/** Start a new migration job */
export const startMigration = command(StartMigrationRequestSchema, async (request) => {
  const { locals } = getRequestEvent();
  const { apiClient } = locals;
  try {
    const result = await apiClient.migration.startMigration(request as StartMigrationRequest);
    return result;
  } catch (err) {
    console.error('Error in migration.startMigration:', err);
    throw error(500, 'Failed to start migration');
  }
});

/** Get the status of a migration job */
export const getStatus = query(z.string(), async (jobId) => {
  const { locals } = getRequestEvent();
  const { apiClient } = locals;
  try {
    return await apiClient.migration.getStatus(jobId);
  } catch (err) {
    console.error('Error in migration.getStatus:', err);
    throw error(500, 'Failed to get status');
  }
});

/** Cancel a running migration job */
export const cancelMigration = command(z.string(), async (jobId) => {
  const { locals } = getRequestEvent();
  const { apiClient } = locals;
  try {
    await apiClient.migration.cancelMigration(jobId);
    return { success: true };
  } catch (err) {
    console.error('Error in migration.cancelMigration:', err);
    throw error(500, 'Failed to cancel migration');
  }
});

/** Get migration job history */
export const getHistory = query(async () => {
  const { locals } = getRequestEvent();
  const { apiClient } = locals;
  try {
    return await apiClient.migration.getHistory();
  } catch (err) {
    console.error('Error in migration.getHistory:', err);
    throw error(500, 'Failed to get history');
  }
});

/** Get pending migration configuration from environment variables */
export const getPendingConfig = query(async () => {
  const { locals } = getRequestEvent();
  const { apiClient } = locals;
  try {
    return await apiClient.migration.getPendingConfig();
  } catch (err) {
    console.error('Error in migration.getPendingConfig:', err);
    throw error(500, 'Failed to get pending config');
  }
});

/** Get saved migration sources with their last migration timestamps */
export const getSources = query(async () => {
  const { locals } = getRequestEvent();
  const { apiClient } = locals;
  try {
    return await apiClient.migration.getSources();
  } catch (err) {
    console.error('Error in migration.getSources:', err);
    throw error(500, 'Failed to get sources');
  }
});
