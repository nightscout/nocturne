// AUTO-GENERATED - DO NOT EDIT
// Generated by @nocturne/remote-function-codegen
// Source: openapi.json

import { getRequestEvent, query, command } from '$app/server';
import { error } from '@sveltejs/kit';
import { z } from 'zod';
import { CreateStateSpanRequestSchema, UpdateStateSpanRequestSchema } from '$lib/api/generated/schemas';
import { StateSpanCategory, type CreateStateSpanRequest, type UpdateStateSpanRequest } from '$api';

/** Query all state spans with optional filtering */
export const getStateSpans = query(z.object({ category: z.enum(StateSpanCategory).optional(), state: z.string().optional(), from: z.number().optional(), to: z.number().optional(), source: z.string().optional(), active: z.boolean().optional(), count: z.number().optional(), skip: z.number().optional() }).optional(), async (params) => {
  const { locals } = getRequestEvent();
  const { apiClient } = locals;
  try {
    return await apiClient.stateSpans.getStateSpans(params?.category, params?.state, params?.from, params?.to, params?.source, params?.active, params?.count, params?.skip);
  } catch (err) {
    console.error('Error in stateSpans.getStateSpans:', err);
    throw error(500, 'Failed to get state spans');
  }
});

/** Create a new state span (manual entry) */
export const createStateSpan = command(CreateStateSpanRequestSchema, async (request) => {
  const { locals } = getRequestEvent();
  const { apiClient } = locals;
  try {
    const result = await apiClient.stateSpans.createStateSpan(request as CreateStateSpanRequest);
    await Promise.all([
      getStateSpans(undefined).refresh()
    ]);
    return result;
  } catch (err) {
    console.error('Error in stateSpans.createStateSpan:', err);
    throw error(500, 'Failed to create state span');
  }
});

/** Get a specific state span by ID */
export const getStateSpan = query(z.string(), async (id) => {
  const { locals } = getRequestEvent();
  const { apiClient } = locals;
  try {
    return await apiClient.stateSpans.getStateSpan(id);
  } catch (err) {
    console.error('Error in stateSpans.getStateSpan:', err);
    throw error(500, 'Failed to get state span');
  }
});

/** Update an existing state span */
export const updateStateSpan = command(z.object({ id: z.string(), request: UpdateStateSpanRequestSchema }), async ({ id, request }) => {
  const { locals } = getRequestEvent();
  const { apiClient } = locals;
  try {
    const result = await apiClient.stateSpans.updateStateSpan(id, request as UpdateStateSpanRequest);
    await Promise.all([
      getStateSpans(undefined).refresh(),
      getStateSpan(id).refresh()
    ]);
    return result;
  } catch (err) {
    console.error('Error in stateSpans.updateStateSpan:', err);
    throw error(500, 'Failed to update state span');
  }
});

/** Delete a state span */
export const deleteStateSpan = command(z.string(), async (id) => {
  const { locals } = getRequestEvent();
  const { apiClient } = locals;
  try {
    await apiClient.stateSpans.deleteStateSpan(id);
    await Promise.all([
      getStateSpans(undefined).refresh()
    ]);
    return { success: true };
  } catch (err) {
    console.error('Error in stateSpans.deleteStateSpan:', err);
    throw error(500, 'Failed to delete state span');
  }
});
