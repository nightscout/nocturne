// AUTO-GENERATED - DO NOT EDIT
// Generated by @nocturne/remote-function-codegen
// Source: openapi.json

import { getRequestEvent, query, command } from '$app/server';
import { error, redirect } from '@sveltejs/kit';
import { z } from 'zod';

/** Get all active notifications for the current user */
export const getNotifications = query(async () => {
  const { locals } = getRequestEvent();
  const { apiClient } = locals;
  try {
    return await apiClient.notifications.getNotifications();
  } catch (err) {
    const status = (err as any)?.status;
    if (status === 401) { const { url } = getRequestEvent(); throw redirect(302, `/login?redirectTo=${encodeURIComponent(url.pathname + url.search)}`); }
    if (status === 403) throw error(403, 'Forbidden');
    console.error('Error in notifications.getNotifications:', err);
    throw error(500, 'Failed to get notifications');
  }
});

/** Execute an action on a notification */
export const executeAction = command(z.object({ id: z.string(), actionId: z.string() }), async ({ id, actionId }) => {
  const { locals } = getRequestEvent();
  const { apiClient } = locals;
  try {
    await apiClient.notifications.executeAction(id, actionId);
    await Promise.all([
      getNotifications(undefined).refresh()
    ]);
    return { success: true };
  } catch (err) {
    const status = (err as any)?.status;
    if (status === 401) { const { url } = getRequestEvent(); throw redirect(302, `/login?redirectTo=${encodeURIComponent(url.pathname + url.search)}`); }
    if (status === 403) throw error(403, 'Forbidden');
    console.error('Error in notifications.executeAction:', err);
    throw error(500, 'Failed to execute action');
  }
});

/** Dismiss a notification (archive with dismissed reason) */
export const dismissNotification = command(z.string(), async (id) => {
  const { locals } = getRequestEvent();
  const { apiClient } = locals;
  try {
    await apiClient.notifications.dismissNotification(id);
    await Promise.all([
      getNotifications(undefined).refresh()
    ]);
    return { success: true };
  } catch (err) {
    const status = (err as any)?.status;
    if (status === 401) { const { url } = getRequestEvent(); throw redirect(302, `/login?redirectTo=${encodeURIComponent(url.pathname + url.search)}`); }
    if (status === 403) throw error(403, 'Forbidden');
    console.error('Error in notifications.dismissNotification:', err);
    throw error(500, 'Failed to dismiss notification');
  }
});
