// AUTO-GENERATED - DO NOT EDIT
// Generated by @nocturne/remote-function-codegen
// Source: openapi.json

import { getRequestEvent, query, command } from '$app/server';
import { error, redirect } from '@sveltejs/kit';
import { z } from 'zod';
import { BolusSchema, BolusCalculationSchema } from '$lib/api/generated/schemas';
import { type Bolus, type BolusCalculation } from '$api';

/** Get boluses with optional filtering */
export const getBoluses = query(z.object({ from: z.number().optional(), to: z.number().optional(), limit: z.number().optional(), offset: z.number().optional(), sort: z.string().optional(), device: z.string().optional(), source: z.string().optional() }).optional(), async (params) => {
  const { locals } = getRequestEvent();
  const { apiClient } = locals;
  try {
    return await apiClient.insulin.getBoluses(params?.from, params?.to, params?.limit, params?.offset, params?.sort, params?.device, params?.source);
  } catch (err) {
    const status = (err as any)?.status;
    if (status === 401) { const { url } = getRequestEvent(); throw redirect(302, `/login?redirectTo=${encodeURIComponent(url.pathname + url.search)}`); }
    if (status === 403) throw error(403, 'Forbidden');
    console.error('Error in insulin.getBoluses:', err);
    throw error(500, 'Failed to get boluses');
  }
});

/** Create a new bolus */
export const createBolus = command(BolusSchema, async (request) => {
  const { locals } = getRequestEvent();
  const { apiClient } = locals;
  try {
    const result = await apiClient.insulin.createBolus(request as Bolus);
    await Promise.all([
      getBoluses(undefined).refresh()
    ]);
    return result;
  } catch (err) {
    const status = (err as any)?.status;
    if (status === 401) { const { url } = getRequestEvent(); throw redirect(302, `/login?redirectTo=${encodeURIComponent(url.pathname + url.search)}`); }
    if (status === 403) throw error(403, 'Forbidden');
    console.error('Error in insulin.createBolus:', err);
    throw error(500, 'Failed to create bolus');
  }
});

/** Get a bolus by ID */
export const getBolusById = query(z.string(), async (id) => {
  const { locals } = getRequestEvent();
  const { apiClient } = locals;
  try {
    return await apiClient.insulin.getBolusById(id);
  } catch (err) {
    const status = (err as any)?.status;
    if (status === 401) { const { url } = getRequestEvent(); throw redirect(302, `/login?redirectTo=${encodeURIComponent(url.pathname + url.search)}`); }
    if (status === 403) throw error(403, 'Forbidden');
    console.error('Error in insulin.getBolusById:', err);
    throw error(500, 'Failed to get bolus by id');
  }
});

/** Update an existing bolus */
export const updateBolus = command(z.object({ id: z.string(), request: BolusSchema }), async ({ id, request }) => {
  const { locals } = getRequestEvent();
  const { apiClient } = locals;
  try {
    const result = await apiClient.insulin.updateBolus(id, request as Bolus);
    await Promise.all([
      getBoluses(undefined).refresh(),
      getBolusById(id).refresh()
    ]);
    return result;
  } catch (err) {
    const status = (err as any)?.status;
    if (status === 401) { const { url } = getRequestEvent(); throw redirect(302, `/login?redirectTo=${encodeURIComponent(url.pathname + url.search)}`); }
    if (status === 403) throw error(403, 'Forbidden');
    console.error('Error in insulin.updateBolus:', err);
    throw error(500, 'Failed to update bolus');
  }
});

/** Delete a bolus */
export const deleteBolus = command(z.string(), async (id) => {
  const { locals } = getRequestEvent();
  const { apiClient } = locals;
  try {
    await apiClient.insulin.deleteBolus(id);
    await Promise.all([
      getBoluses(undefined).refresh()
    ]);
    return { success: true };
  } catch (err) {
    const status = (err as any)?.status;
    if (status === 401) { const { url } = getRequestEvent(); throw redirect(302, `/login?redirectTo=${encodeURIComponent(url.pathname + url.search)}`); }
    if (status === 403) throw error(403, 'Forbidden');
    console.error('Error in insulin.deleteBolus:', err);
    throw error(500, 'Failed to delete bolus');
  }
});

/** Get bolus calculations with optional filtering */
export const getBolusCalculations = query(z.object({ from: z.number().optional(), to: z.number().optional(), limit: z.number().optional(), offset: z.number().optional(), sort: z.string().optional(), device: z.string().optional(), source: z.string().optional() }).optional(), async (params) => {
  const { locals } = getRequestEvent();
  const { apiClient } = locals;
  try {
    return await apiClient.insulin.getBolusCalculations(params?.from, params?.to, params?.limit, params?.offset, params?.sort, params?.device, params?.source);
  } catch (err) {
    const status = (err as any)?.status;
    if (status === 401) { const { url } = getRequestEvent(); throw redirect(302, `/login?redirectTo=${encodeURIComponent(url.pathname + url.search)}`); }
    if (status === 403) throw error(403, 'Forbidden');
    console.error('Error in insulin.getBolusCalculations:', err);
    throw error(500, 'Failed to get bolus calculations');
  }
});

/** Create a new bolus calculation */
export const createBolusCalculation = command(BolusCalculationSchema, async (request) => {
  const { locals } = getRequestEvent();
  const { apiClient } = locals;
  try {
    const result = await apiClient.insulin.createBolusCalculation(request as BolusCalculation);
    await Promise.all([
      getBolusCalculations(undefined).refresh()
    ]);
    return result;
  } catch (err) {
    const status = (err as any)?.status;
    if (status === 401) { const { url } = getRequestEvent(); throw redirect(302, `/login?redirectTo=${encodeURIComponent(url.pathname + url.search)}`); }
    if (status === 403) throw error(403, 'Forbidden');
    console.error('Error in insulin.createBolusCalculation:', err);
    throw error(500, 'Failed to create bolus calculation');
  }
});

/** Get a bolus calculation by ID */
export const getBolusCalculationById = query(z.string(), async (id) => {
  const { locals } = getRequestEvent();
  const { apiClient } = locals;
  try {
    return await apiClient.insulin.getBolusCalculationById(id);
  } catch (err) {
    const status = (err as any)?.status;
    if (status === 401) { const { url } = getRequestEvent(); throw redirect(302, `/login?redirectTo=${encodeURIComponent(url.pathname + url.search)}`); }
    if (status === 403) throw error(403, 'Forbidden');
    console.error('Error in insulin.getBolusCalculationById:', err);
    throw error(500, 'Failed to get bolus calculation by id');
  }
});

/** Update an existing bolus calculation */
export const updateBolusCalculation = command(z.object({ id: z.string(), request: BolusCalculationSchema }), async ({ id, request }) => {
  const { locals } = getRequestEvent();
  const { apiClient } = locals;
  try {
    const result = await apiClient.insulin.updateBolusCalculation(id, request as BolusCalculation);
    await Promise.all([
      getBolusCalculations(undefined).refresh(),
      getBolusCalculationById(id).refresh()
    ]);
    return result;
  } catch (err) {
    const status = (err as any)?.status;
    if (status === 401) { const { url } = getRequestEvent(); throw redirect(302, `/login?redirectTo=${encodeURIComponent(url.pathname + url.search)}`); }
    if (status === 403) throw error(403, 'Forbidden');
    console.error('Error in insulin.updateBolusCalculation:', err);
    throw error(500, 'Failed to update bolus calculation');
  }
});

/** Delete a bolus calculation */
export const deleteBolusCalculation = command(z.string(), async (id) => {
  const { locals } = getRequestEvent();
  const { apiClient } = locals;
  try {
    await apiClient.insulin.deleteBolusCalculation(id);
    await Promise.all([
      getBolusCalculations(undefined).refresh()
    ]);
    return { success: true };
  } catch (err) {
    const status = (err as any)?.status;
    if (status === 401) { const { url } = getRequestEvent(); throw redirect(302, `/login?redirectTo=${encodeURIComponent(url.pathname + url.search)}`); }
    if (status === 403) throw error(403, 'Forbidden');
    console.error('Error in insulin.deleteBolusCalculation:', err);
    throw error(500, 'Failed to delete bolus calculation');
  }
});
