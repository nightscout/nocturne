// AUTO-GENERATED - DO NOT EDIT
// Generated by @nocturne/remote-function-codegen
// Source: openapi.json

import { getRequestEvent, query } from '$app/server';
import { error } from '@sveltejs/kit';
import { z } from 'zod';
import { TimeInRangeRequestSchema, EntrySchema } from '$lib/api/generated/schemas';
import { type TimeInRangeRequest, type Entry } from '$api';

/** Calculate time in range metrics */
export const calculateTimeInRange = query(TimeInRangeRequestSchema, async (request) => {
  const { locals } = getRequestEvent();
  const { apiClient } = locals;
  try {
    return await apiClient.statistics.calculateTimeInRange(request as TimeInRangeRequest);
  } catch (err) {
    console.error('Error in statistics.calculateTimeInRange:', err);
    throw error(500, 'Failed to calculate time in range');
  }
});

/** Calculate averaged statistics for each hour of the day (0-23) */
export const calculateAveragedStats = query(z.array(EntrySchema), async (request) => {
  const { locals } = getRequestEvent();
  const { apiClient } = locals;
  try {
    return await apiClient.statistics.calculateAveragedStats(request as Entry[]);
  } catch (err) {
    console.error('Error in statistics.calculateAveragedStats:', err);
    throw error(500, 'Failed to calculate averaged stats');
  }
});

/** Get comprehensive statistics for multiple time periods (1, 3, 7, 30, 90 days)
Uses in-memory cache for performance with daily expiration */
export const getMultiPeriodStatistics = query(async () => {
  const { locals } = getRequestEvent();
  const { apiClient } = locals;
  try {
    return await apiClient.statistics.getMultiPeriodStatistics();
  } catch (err) {
    console.error('Error in statistics.getMultiPeriodStatistics:', err);
    throw error(500, 'Failed to get multi period statistics');
  }
});

/** Calculate daily basal/bolus ratio statistics for a date range */
export const getDailyBasalBolusRatios = query(z.object({ startDate: z.coerce.date().optional(), endDate: z.coerce.date().optional() }).optional(), async (params) => {
  const { locals } = getRequestEvent();
  const { apiClient } = locals;
  try {
    return await apiClient.statistics.getDailyBasalBolusRatios(params?.startDate, params?.endDate);
  } catch (err) {
    console.error('Error in statistics.getDailyBasalBolusRatios:', err);
    throw error(500, 'Failed to get daily basal bolus ratios');
  }
});

/** Calculate comprehensive insulin delivery statistics for a date range */
export const getInsulinDeliveryStatistics = query(z.object({ startDate: z.coerce.date().optional(), endDate: z.coerce.date().optional() }).optional(), async (params) => {
  const { locals } = getRequestEvent();
  const { apiClient } = locals;
  try {
    return await apiClient.statistics.getInsulinDeliveryStatistics(params?.startDate, params?.endDate);
  } catch (err) {
    console.error('Error in statistics.getInsulinDeliveryStatistics:', err);
    throw error(500, 'Failed to get insulin delivery statistics');
  }
});

/** Calculate comprehensive basal analysis statistics for a date range */
export const getBasalAnalysis = query(z.object({ startDate: z.coerce.date().optional(), endDate: z.coerce.date().optional() }).optional(), async (params) => {
  const { locals } = getRequestEvent();
  const { apiClient } = locals;
  try {
    return await apiClient.statistics.getBasalAnalysis(params?.startDate, params?.endDate);
  } catch (err) {
    console.error('Error in statistics.getBasalAnalysis:', err);
    throw error(500, 'Failed to get basal analysis');
  }
});
