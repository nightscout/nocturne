// AUTO-GENERATED - DO NOT EDIT
// Generated by @nocturne/remote-function-codegen
// Source: openapi.json

import { getRequestEvent, query, command } from '$app/server';
import { error } from '@sveltejs/kit';
import { z } from 'zod';
import { SetTemporaryPasswordRequestSchema } from '$lib/api/generated/schemas';
import { type SetTemporaryPasswordRequest } from '$api';

/** Get pending password reset requests (admin only) */
export const getPendingPasswordResets = query(async () => {
  const { locals } = getRequestEvent();
  const { apiClient } = locals;
  try {
    return await apiClient.localAuth.getPendingPasswordResets();
  } catch (err) {
    console.error('Error in localAuth.getPendingPasswordResets:', err);
    throw error(500, 'Failed to get pending password resets');
  }
});

/** Set a temporary password for a user (admin only) */
export const setTemporaryPassword = command(SetTemporaryPasswordRequestSchema, async (request) => {
  const { locals } = getRequestEvent();
  const { apiClient } = locals;
  try {
    const result = await apiClient.localAuth.setTemporaryPassword(request as SetTemporaryPasswordRequest);
    await Promise.all([
      getPendingPasswordResets(undefined).refresh()
    ]);
    return result;
  } catch (err) {
    console.error('Error in localAuth.setTemporaryPassword:', err);
    throw error(500, 'Failed to set temporary password');
  }
});

/** Handle a password reset request by generating a reset link (admin only) */
export const handlePasswordReset = command(z.string(), async (requestId) => {
  const { locals } = getRequestEvent();
  const { apiClient } = locals;
  try {
    const result = await apiClient.localAuth.handlePasswordReset(requestId);
    await Promise.all([
      getPendingPasswordResets(undefined).refresh()
    ]);
    return result;
  } catch (err) {
    console.error('Error in localAuth.handlePasswordReset:', err);
    throw error(500, 'Failed to handle password reset');
  }
});
