// <auto-generated />
using System;
using Microsoft.EntityFrameworkCore;
using Microsoft.EntityFrameworkCore.Infrastructure;
using Microsoft.EntityFrameworkCore.Migrations;
using Microsoft.EntityFrameworkCore.Storage.ValueConversion;
using Nocturne.Infrastructure.Data;
using Npgsql.EntityFrameworkCore.PostgreSQL.Metadata;

#nullable disable

namespace Nocturne.Infrastructure.Data.Migrations
{
    [DbContext(typeof(NocturneDbContext))]
    [Migration("20260115221057_AddLinkedRecordsTable")]
    partial class AddLinkedRecordsTable
    {
        /// <inheritdoc />
        protected override void BuildTargetModel(ModelBuilder modelBuilder)
        {
#pragma warning disable 612, 618
            modelBuilder
                .HasAnnotation("ProductVersion", "10.0.1")
                .HasAnnotation("Relational:MaxIdentifierLength", 63);

            NpgsqlModelBuilderExtensions.UseIdentityByDefaultColumns(modelBuilder);

            modelBuilder.Entity("Nocturne.Infrastructure.Data.Entities.ActivityEntity", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("AdditionalPropertiesJson")
                        .HasColumnType("jsonb")
                        .HasColumnName("additional_properties");

                    b.Property<string>("CreatedAt")
                        .HasMaxLength(50)
                        .HasColumnType("character varying(50)")
                        .HasColumnName("created_at");

                    b.Property<string>("DateString")
                        .HasMaxLength(50)
                        .HasColumnType("character varying(50)")
                        .HasColumnName("dateString");

                    b.Property<string>("Description")
                        .HasColumnType("text")
                        .HasColumnName("description");

                    b.Property<double?>("Duration")
                        .HasColumnType("double precision")
                        .HasColumnName("duration");

                    b.Property<string>("EnteredBy")
                        .HasMaxLength(255)
                        .HasColumnType("character varying(255)")
                        .HasColumnName("enteredBy");

                    b.Property<string>("Intensity")
                        .HasMaxLength(50)
                        .HasColumnType("character varying(50)")
                        .HasColumnName("intensity");

                    b.Property<long>("Mills")
                        .HasColumnType("bigint")
                        .HasColumnName("mills");

                    b.Property<string>("Notes")
                        .HasColumnType("text")
                        .HasColumnName("notes");

                    b.Property<string>("OriginalId")
                        .HasMaxLength(24)
                        .HasColumnType("character varying(24)")
                        .HasColumnName("original_id");

                    b.Property<DateTime>("SysCreatedAt")
                        .HasColumnType("timestamp with time zone")
                        .HasColumnName("sys_created_at");

                    b.Property<DateTime>("SysUpdatedAt")
                        .ValueGeneratedOnAddOrUpdate()
                        .HasColumnType("timestamp with time zone")
                        .HasColumnName("sys_updated_at")
                        .HasDefaultValueSql("CURRENT_TIMESTAMP");

                    b.Property<long?>("Timestamp")
                        .HasColumnType("bigint")
                        .HasColumnName("timestamp");

                    b.Property<string>("Type")
                        .HasMaxLength(100)
                        .HasColumnType("character varying(100)")
                        .HasColumnName("type");

                    b.Property<int?>("UtcOffset")
                        .HasColumnType("integer")
                        .HasColumnName("utcOffset");

                    b.HasKey("Id");

                    b.HasIndex("Mills")
                        .IsDescending()
                        .HasDatabaseName("ix_activities_mills");

                    b.HasIndex("SysCreatedAt")
                        .HasDatabaseName("ix_activities_sys_created_at");

                    b.HasIndex("Type")
                        .HasDatabaseName("ix_activities_type");

                    b.HasIndex("Type", "Mills")
                        .IsDescending(false, true)
                        .HasDatabaseName("ix_activities_type_mills");

                    b.ToTable("activities");
                });

            modelBuilder.Entity("Nocturne.Infrastructure.Data.Entities.AlertHistoryEntity", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<DateTime?>("AcknowledgedAt")
                        .HasColumnType("timestamp with time zone")
                        .HasColumnName("acknowledged_at");

                    b.Property<string>("AcknowledgmentNotes")
                        .HasMaxLength(1000)
                        .HasColumnType("character varying(1000)")
                        .HasColumnName("acknowledgment_notes");

                    b.Property<Guid?>("AlertRuleId")
                        .HasColumnType("uuid")
                        .HasColumnName("alert_rule_id");

                    b.Property<string>("AlertType")
                        .IsRequired()
                        .HasMaxLength(50)
                        .HasColumnType("character varying(50)")
                        .HasColumnName("alert_type");

                    b.Property<DateTime>("CreatedAt")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("timestamp with time zone")
                        .HasColumnName("created_at")
                        .HasDefaultValueSql("CURRENT_TIMESTAMP");

                    b.Property<string>("EscalationAttempts")
                        .IsRequired()
                        .HasColumnType("jsonb")
                        .HasColumnName("escalation_attempts");

                    b.Property<int>("EscalationLevel")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("integer")
                        .HasDefaultValue(0)
                        .HasColumnName("escalation_level");

                    b.Property<bool>("EscalationPaused")
                        .HasColumnType("boolean")
                        .HasColumnName("escalation_paused");

                    b.Property<string>("EscalationReason")
                        .HasMaxLength(500)
                        .HasColumnType("character varying(500)")
                        .HasColumnName("escalation_reason");

                    b.Property<decimal?>("GlucoseValue")
                        .HasColumnType("numeric")
                        .HasColumnName("glucose_value");

                    b.Property<DateTime?>("NextEscalationTime")
                        .HasColumnType("timestamp with time zone")
                        .HasColumnName("next_escalation_time");

                    b.Property<string>("NotificationsSent")
                        .IsRequired()
                        .ValueGeneratedOnAdd()
                        .HasColumnType("jsonb")
                        .HasDefaultValue("[]")
                        .HasColumnName("notifications_sent");

                    b.Property<DateTime?>("ResolvedAt")
                        .HasColumnType("timestamp with time zone")
                        .HasColumnName("resolved_at");

                    b.Property<int>("SnoozeCount")
                        .HasColumnType("integer")
                        .HasColumnName("snooze_count");

                    b.Property<string>("SnoozeReason")
                        .HasMaxLength(500)
                        .HasColumnType("character varying(500)")
                        .HasColumnName("snooze_reason");

                    b.Property<DateTime?>("SnoozeUntil")
                        .HasColumnType("timestamp with time zone")
                        .HasColumnName("snooze_until");

                    b.Property<string>("Status")
                        .IsRequired()
                        .HasMaxLength(50)
                        .HasColumnType("character varying(50)")
                        .HasColumnName("status");

                    b.Property<decimal?>("Threshold")
                        .HasColumnType("numeric")
                        .HasColumnName("threshold");

                    b.Property<DateTime>("TriggerTime")
                        .HasColumnType("timestamp with time zone")
                        .HasColumnName("trigger_time");

                    b.Property<DateTime>("UpdatedAt")
                        .ValueGeneratedOnAddOrUpdate()
                        .HasColumnType("timestamp with time zone")
                        .HasColumnName("updated_at")
                        .HasDefaultValueSql("CURRENT_TIMESTAMP");

                    b.Property<string>("UserId")
                        .IsRequired()
                        .HasMaxLength(255)
                        .HasColumnType("character varying(255)")
                        .HasColumnName("user_id");

                    b.HasKey("Id");

                    b.HasIndex("AlertRuleId")
                        .HasDatabaseName("ix_alert_history_alert_rule_id");

                    b.HasIndex("AlertType")
                        .HasDatabaseName("ix_alert_history_alert_type");

                    b.HasIndex("Status")
                        .HasDatabaseName("ix_alert_history_status");

                    b.HasIndex("TriggerTime")
                        .IsDescending()
                        .HasDatabaseName("ix_alert_history_trigger_time");

                    b.HasIndex("UserId")
                        .HasDatabaseName("ix_alert_history_user_id");

                    b.HasIndex("UserId", "Status")
                        .HasDatabaseName("ix_alert_history_user_status");

                    b.HasIndex("UserId", "TriggerTime")
                        .IsDescending(false, true)
                        .HasDatabaseName("ix_alert_history_user_trigger_time");

                    b.ToTable("alert_history");
                });

            modelBuilder.Entity("Nocturne.Infrastructure.Data.Entities.AlertRuleEntity", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("ActiveHours")
                        .HasColumnType("jsonb")
                        .HasColumnName("active_hours");

                    b.Property<string>("ClientConfiguration")
                        .HasColumnType("jsonb")
                        .HasColumnName("client_configuration");

                    b.Property<int>("CooldownMinutes")
                        .HasColumnType("integer")
                        .HasColumnName("cooldown_minutes");

                    b.Property<DateTime>("CreatedAt")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("timestamp with time zone")
                        .HasColumnName("created_at")
                        .HasDefaultValueSql("CURRENT_TIMESTAMP");

                    b.Property<string>("DaysOfWeek")
                        .HasColumnType("jsonb")
                        .HasColumnName("days_of_week");

                    b.Property<int>("DefaultSnoozeMinutes")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("integer")
                        .HasDefaultValue(30)
                        .HasColumnName("default_snooze_minutes");

                    b.Property<int>("EscalationDelayMinutes")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("integer")
                        .HasDefaultValue(15)
                        .HasColumnName("escalation_delay_minutes");

                    b.Property<int?>("ForecastLeadTimeMinutes")
                        .HasColumnType("integer")
                        .HasColumnName("forecast_lead_time_minutes");

                    b.Property<decimal?>("HighThreshold")
                        .HasColumnType("numeric")
                        .HasColumnName("high_threshold");

                    b.Property<bool>("IsEnabled")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("boolean")
                        .HasDefaultValue(true)
                        .HasColumnName("is_enabled");

                    b.Property<decimal?>("LowThreshold")
                        .HasColumnType("numeric")
                        .HasColumnName("low_threshold");

                    b.Property<int>("MaxEscalations")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("integer")
                        .HasDefaultValue(3)
                        .HasColumnName("max_escalations");

                    b.Property<int>("MaxSnoozeMinutes")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("integer")
                        .HasDefaultValue(120)
                        .HasColumnName("max_snooze_minutes");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasMaxLength(255)
                        .HasColumnType("character varying(255)")
                        .HasColumnName("name");

                    b.Property<string>("NotificationChannels")
                        .IsRequired()
                        .ValueGeneratedOnAdd()
                        .HasColumnType("jsonb")
                        .HasDefaultValue("[]")
                        .HasColumnName("notification_channels");

                    b.Property<DateTime>("UpdatedAt")
                        .ValueGeneratedOnAddOrUpdate()
                        .HasColumnType("timestamp with time zone")
                        .HasColumnName("updated_at")
                        .HasDefaultValueSql("CURRENT_TIMESTAMP");

                    b.Property<decimal?>("UrgentHighThreshold")
                        .HasColumnType("numeric")
                        .HasColumnName("urgent_high_threshold");

                    b.Property<decimal?>("UrgentLowThreshold")
                        .HasColumnType("numeric")
                        .HasColumnName("urgent_low_threshold");

                    b.Property<string>("UserId")
                        .IsRequired()
                        .HasMaxLength(255)
                        .HasColumnType("character varying(255)")
                        .HasColumnName("user_id");

                    b.HasKey("Id");

                    b.HasIndex("CreatedAt")
                        .HasDatabaseName("ix_alert_rules_created_at");

                    b.HasIndex("IsEnabled")
                        .HasDatabaseName("ix_alert_rules_is_enabled");

                    b.HasIndex("UserId")
                        .HasDatabaseName("ix_alert_rules_user_id");

                    b.HasIndex("UserId", "IsEnabled")
                        .HasDatabaseName("ix_alert_rules_user_enabled");

                    b.ToTable("alert_rules");
                });

            modelBuilder.Entity("Nocturne.Infrastructure.Data.Entities.AuthAuditLogEntity", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("CorrelationId")
                        .HasMaxLength(50)
                        .HasColumnType("character varying(50)")
                        .HasColumnName("correlation_id");

                    b.Property<DateTime>("CreatedAt")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("timestamp with time zone")
                        .HasColumnName("created_at")
                        .HasDefaultValueSql("CURRENT_TIMESTAMP");

                    b.Property<string>("DetailsJson")
                        .HasColumnType("jsonb")
                        .HasColumnName("details");

                    b.Property<string>("ErrorMessage")
                        .HasMaxLength(500)
                        .HasColumnType("character varying(500)")
                        .HasColumnName("error_message");

                    b.Property<string>("EventType")
                        .IsRequired()
                        .HasMaxLength(50)
                        .HasColumnType("character varying(50)")
                        .HasColumnName("event_type");

                    b.Property<string>("IpAddress")
                        .HasMaxLength(45)
                        .HasColumnType("character varying(45)")
                        .HasColumnName("ip_address");

                    b.Property<Guid?>("RefreshTokenId")
                        .HasColumnType("uuid")
                        .HasColumnName("refresh_token_id");

                    b.Property<Guid?>("SubjectId")
                        .HasColumnType("uuid")
                        .HasColumnName("subject_id");

                    b.Property<bool>("Success")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("boolean")
                        .HasDefaultValue(true)
                        .HasColumnName("success");

                    b.Property<string>("UserAgent")
                        .HasColumnType("text")
                        .HasColumnName("user_agent");

                    b.HasKey("Id");

                    b.HasIndex("CreatedAt")
                        .IsDescending()
                        .HasDatabaseName("ix_auth_audit_log_created_at");

                    b.HasIndex("EventType")
                        .HasDatabaseName("ix_auth_audit_log_event_type");

                    b.HasIndex("IpAddress")
                        .HasDatabaseName("ix_auth_audit_log_ip_address");

                    b.HasIndex("RefreshTokenId");

                    b.HasIndex("SubjectId")
                        .HasDatabaseName("ix_auth_audit_log_subject_id");

                    b.HasIndex("SubjectId", "CreatedAt")
                        .IsDescending(false, true)
                        .HasDatabaseName("ix_auth_audit_log_subject_created");

                    b.ToTable("auth_audit_log");
                });

            modelBuilder.Entity("Nocturne.Infrastructure.Data.Entities.ConnectorFoodEntryEntity", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<decimal>("Carbs")
                        .HasColumnType("numeric")
                        .HasColumnName("carbs");

                    b.Property<string>("ConnectorSource")
                        .IsRequired()
                        .HasMaxLength(50)
                        .HasColumnType("character varying(50)")
                        .HasColumnName("connector_source");

                    b.Property<DateTimeOffset>("ConsumedAt")
                        .HasColumnType("timestamp with time zone")
                        .HasColumnName("consumed_at");

                    b.Property<decimal>("Energy")
                        .HasColumnType("numeric")
                        .HasColumnName("energy");

                    b.Property<string>("ExternalEntryId")
                        .IsRequired()
                        .HasMaxLength(255)
                        .HasColumnType("character varying(255)")
                        .HasColumnName("external_entry_id");

                    b.Property<string>("ExternalFoodId")
                        .IsRequired()
                        .HasMaxLength(255)
                        .HasColumnType("character varying(255)")
                        .HasColumnName("external_food_id");

                    b.Property<decimal>("Fat")
                        .HasColumnType("numeric")
                        .HasColumnName("fat");

                    b.Property<Guid?>("FoodId")
                        .HasColumnType("uuid")
                        .HasColumnName("food_id");

                    b.Property<DateTimeOffset?>("LoggedAt")
                        .HasColumnType("timestamp with time zone")
                        .HasColumnName("logged_at");

                    b.Property<Guid?>("MatchedTreatmentId")
                        .HasColumnType("uuid")
                        .HasColumnName("matched_treatment_id");

                    b.Property<string>("MealName")
                        .IsRequired()
                        .HasMaxLength(50)
                        .HasColumnType("character varying(50)")
                        .HasColumnName("meal_name");

                    b.Property<decimal>("Protein")
                        .HasColumnType("numeric")
                        .HasColumnName("protein");

                    b.Property<DateTimeOffset?>("ResolvedAt")
                        .HasColumnType("timestamp with time zone")
                        .HasColumnName("resolved_at");

                    b.Property<string>("ServingDescription")
                        .HasMaxLength(100)
                        .HasColumnType("character varying(100)")
                        .HasColumnName("serving_description");

                    b.Property<decimal>("Servings")
                        .HasColumnType("numeric")
                        .HasColumnName("servings");

                    b.Property<string>("Status")
                        .IsRequired()
                        .ValueGeneratedOnAdd()
                        .HasMaxLength(20)
                        .HasColumnType("character varying(20)")
                        .HasDefaultValue("Pending")
                        .HasColumnName("status");

                    b.Property<DateTime>("SysCreatedAt")
                        .HasColumnType("timestamp with time zone")
                        .HasColumnName("sys_created_at");

                    b.Property<DateTime>("SysUpdatedAt")
                        .ValueGeneratedOnAddOrUpdate()
                        .HasColumnType("timestamp with time zone")
                        .HasColumnName("sys_updated_at")
                        .HasDefaultValueSql("CURRENT_TIMESTAMP");

                    b.HasKey("Id");

                    b.HasIndex("ConnectorSource")
                        .HasDatabaseName("ix_connector_food_entries_source");

                    b.HasIndex("ConsumedAt")
                        .HasDatabaseName("ix_connector_food_entries_consumed_at");

                    b.HasIndex("ExternalEntryId")
                        .HasDatabaseName("ix_connector_food_entries_external_entry_id");

                    b.HasIndex("FoodId");

                    b.HasIndex("MatchedTreatmentId");

                    b.HasIndex("Status")
                        .HasDatabaseName("ix_connector_food_entries_status");

                    b.HasIndex("SysCreatedAt")
                        .HasDatabaseName("ix_connector_food_entries_sys_created_at");

                    b.HasIndex("ConnectorSource", "ExternalEntryId")
                        .IsUnique()
                        .HasDatabaseName("ix_connector_food_entries_source_entry");

                    b.ToTable("connector_food_entries");
                });

            modelBuilder.Entity("Nocturne.Infrastructure.Data.Entities.DataSourceMetadataEntity", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid")
                        .HasColumnName("id");

                    b.Property<DateTimeOffset?>("ArchivedAt")
                        .HasColumnType("timestamp with time zone")
                        .HasColumnName("archived_at");

                    b.Property<DateTimeOffset>("CreatedAt")
                        .HasColumnType("timestamp with time zone")
                        .HasColumnName("created_at");

                    b.Property<string>("DeviceId")
                        .IsRequired()
                        .HasMaxLength(255)
                        .HasColumnType("character varying(255)")
                        .HasColumnName("device_id");

                    b.Property<bool>("IsArchived")
                        .HasColumnType("boolean")
                        .HasColumnName("is_archived");

                    b.Property<string>("Notes")
                        .HasMaxLength(1000)
                        .HasColumnType("character varying(1000)")
                        .HasColumnName("notes");

                    b.Property<DateTimeOffset>("UpdatedAt")
                        .HasColumnType("timestamp with time zone")
                        .HasColumnName("updated_at");

                    b.HasKey("Id");

                    b.HasIndex("CreatedAt")
                        .HasDatabaseName("ix_data_source_metadata_created_at");

                    b.HasIndex("DeviceId")
                        .IsUnique()
                        .HasDatabaseName("ix_data_source_metadata_device_id");

                    b.HasIndex("IsArchived")
                        .HasDatabaseName("ix_data_source_metadata_is_archived");

                    b.ToTable("data_source_metadata");
                });

            modelBuilder.Entity("Nocturne.Infrastructure.Data.Entities.DeviceHealthEntity", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<decimal?>("BatteryLevel")
                        .HasColumnType("numeric")
                        .HasColumnName("battery_level");

                    b.Property<decimal>("BatteryWarningThreshold")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("numeric")
                        .HasDefaultValue(20.0m)
                        .HasColumnName("battery_warning_threshold");

                    b.Property<int>("CalibrationReminderHours")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("integer")
                        .HasDefaultValue(12)
                        .HasColumnName("calibration_reminder_hours");

                    b.Property<DateTime>("CreatedAt")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("timestamp with time zone")
                        .HasColumnName("created_at")
                        .HasDefaultValueSql("CURRENT_TIMESTAMP");

                    b.Property<int>("DataGapWarningMinutes")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("integer")
                        .HasDefaultValue(30)
                        .HasColumnName("data_gap_warning_minutes");

                    b.Property<string>("DeviceId")
                        .IsRequired()
                        .HasMaxLength(255)
                        .HasColumnType("character varying(255)")
                        .HasColumnName("device_id");

                    b.Property<string>("DeviceName")
                        .IsRequired()
                        .HasMaxLength(255)
                        .HasColumnType("character varying(255)")
                        .HasColumnName("device_name");

                    b.Property<int>("DeviceType")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("integer")
                        .HasDefaultValue(3)
                        .HasColumnName("device_type");

                    b.Property<DateTime?>("LastCalibration")
                        .HasColumnType("timestamp with time zone")
                        .HasColumnName("last_calibration");

                    b.Property<DateTime?>("LastDataReceived")
                        .HasColumnType("timestamp with time zone")
                        .HasColumnName("last_data_received");

                    b.Property<string>("LastErrorMessage")
                        .HasMaxLength(1000)
                        .HasColumnType("character varying(1000)")
                        .HasColumnName("last_error_message");

                    b.Property<DateTime?>("LastMaintenanceAlert")
                        .HasColumnType("timestamp with time zone")
                        .HasColumnName("last_maintenance_alert");

                    b.Property<DateTime?>("LastStatusUpdate")
                        .HasColumnType("timestamp with time zone")
                        .HasColumnName("last_status_update");

                    b.Property<string>("Manufacturer")
                        .HasMaxLength(255)
                        .HasColumnType("character varying(255)")
                        .HasColumnName("manufacturer");

                    b.Property<string>("Model")
                        .HasMaxLength(255)
                        .HasColumnType("character varying(255)")
                        .HasColumnName("model");

                    b.Property<DateTime?>("SensorExpiration")
                        .HasColumnType("timestamp with time zone")
                        .HasColumnName("sensor_expiration");

                    b.Property<int>("SensorExpirationWarningHours")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("integer")
                        .HasDefaultValue(24)
                        .HasColumnName("sensor_expiration_warning_hours");

                    b.Property<string>("SerialNumber")
                        .HasMaxLength(255)
                        .HasColumnType("character varying(255)")
                        .HasColumnName("serial_number");

                    b.Property<int>("Status")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("integer")
                        .HasDefaultValue(0)
                        .HasColumnName("status");

                    b.Property<DateTime>("UpdatedAt")
                        .ValueGeneratedOnAddOrUpdate()
                        .HasColumnType("timestamp with time zone")
                        .HasColumnName("updated_at")
                        .HasDefaultValueSql("CURRENT_TIMESTAMP");

                    b.Property<string>("UserId")
                        .IsRequired()
                        .HasMaxLength(255)
                        .HasColumnType("character varying(255)")
                        .HasColumnName("user_id");

                    b.HasKey("Id");

                    b.HasIndex("CreatedAt")
                        .HasDatabaseName("ix_device_health_created_at");

                    b.HasIndex("DeviceId")
                        .IsUnique()
                        .HasDatabaseName("ix_device_health_device_id");

                    b.HasIndex("DeviceType")
                        .HasDatabaseName("ix_device_health_device_type");

                    b.HasIndex("LastDataReceived")
                        .IsDescending()
                        .HasDatabaseName("ix_device_health_last_data_received");

                    b.HasIndex("LastMaintenanceAlert")
                        .HasDatabaseName("ix_device_health_last_maintenance_alert");

                    b.HasIndex("SensorExpiration")
                        .HasDatabaseName("ix_device_health_sensor_expiration");

                    b.HasIndex("Status")
                        .HasDatabaseName("ix_device_health_status");

                    b.HasIndex("UserId")
                        .HasDatabaseName("ix_device_health_user_id");

                    b.HasIndex("UserId", "DeviceType")
                        .HasDatabaseName("ix_device_health_user_device_type");

                    b.HasIndex("UserId", "Status")
                        .HasDatabaseName("ix_device_health_user_status");

                    b.ToTable("device_health");
                });

            modelBuilder.Entity("Nocturne.Infrastructure.Data.Entities.DeviceStatusEntity", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("AdditionalPropertiesJson")
                        .HasColumnType("jsonb")
                        .HasColumnName("additional_properties");

                    b.Property<string>("CgmJson")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("jsonb")
                        .HasDefaultValue("null")
                        .HasColumnName("cgm");

                    b.Property<string>("ConnectJson")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("jsonb")
                        .HasDefaultValue("null")
                        .HasColumnName("connect");

                    b.Property<string>("CreatedAt")
                        .HasMaxLength(50)
                        .HasColumnType("character varying(50)")
                        .HasColumnName("created_at");

                    b.Property<string>("Device")
                        .IsRequired()
                        .HasMaxLength(255)
                        .HasColumnType("character varying(255)")
                        .HasColumnName("device");

                    b.Property<string>("InsulinPenJson")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("jsonb")
                        .HasDefaultValue("null")
                        .HasColumnName("insulinPen");

                    b.Property<bool?>("IsCharging")
                        .HasColumnType("boolean")
                        .HasColumnName("isCharging");

                    b.Property<string>("LoopJson")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("jsonb")
                        .HasDefaultValue("null")
                        .HasColumnName("loop");

                    b.Property<string>("MeterJson")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("jsonb")
                        .HasDefaultValue("null")
                        .HasColumnName("meter");

                    b.Property<long>("Mills")
                        .HasColumnType("bigint")
                        .HasColumnName("mills");

                    b.Property<string>("OpenApsJson")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("jsonb")
                        .HasDefaultValue("null")
                        .HasColumnName("openaps");

                    b.Property<string>("OriginalId")
                        .HasMaxLength(24)
                        .HasColumnType("character varying(24)")
                        .HasColumnName("original_id");

                    b.Property<string>("OverrideJson")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("jsonb")
                        .HasDefaultValue("null")
                        .HasColumnName("override");

                    b.Property<string>("PumpJson")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("jsonb")
                        .HasDefaultValue("null")
                        .HasColumnName("pump");

                    b.Property<string>("RadioAdapterJson")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("jsonb")
                        .HasDefaultValue("null")
                        .HasColumnName("radioAdapter");

                    b.Property<DateTime>("SysCreatedAt")
                        .HasColumnType("timestamp with time zone")
                        .HasColumnName("sys_created_at");

                    b.Property<DateTime>("SysUpdatedAt")
                        .ValueGeneratedOnAddOrUpdate()
                        .HasColumnType("timestamp with time zone")
                        .HasColumnName("sys_updated_at")
                        .HasDefaultValueSql("CURRENT_TIMESTAMP");

                    b.Property<string>("UploaderJson")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("jsonb")
                        .HasDefaultValue("null")
                        .HasColumnName("uploader");

                    b.Property<int?>("UtcOffset")
                        .HasColumnType("integer")
                        .HasColumnName("utcOffset");

                    b.Property<string>("XDripJsJson")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("jsonb")
                        .HasDefaultValue("null")
                        .HasColumnName("xdripjs");

                    b.HasKey("Id");

                    b.HasIndex("Device")
                        .HasDatabaseName("ix_devicestatus_device");

                    b.HasIndex("Mills")
                        .IsDescending()
                        .HasDatabaseName("ix_devicestatus_mills");

                    b.HasIndex("SysCreatedAt")
                        .HasDatabaseName("ix_devicestatus_sys_created_at");

                    b.HasIndex("Device", "Mills")
                        .IsDescending(false, true)
                        .HasDatabaseName("ix_devicestatus_device_mills");

                    b.ToTable("devicestatus");
                });

            modelBuilder.Entity("Nocturne.Infrastructure.Data.Entities.DiscrepancyAnalysisEntity", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid")
                        .HasColumnName("id");

                    b.Property<DateTimeOffset>("AnalysisTimestamp")
                        .HasColumnType("timestamp with time zone")
                        .HasColumnName("analysis_timestamp");

                    b.Property<bool>("BodyMatch")
                        .HasColumnType("boolean")
                        .HasColumnName("body_match");

                    b.Property<string>("CorrelationId")
                        .IsRequired()
                        .HasMaxLength(128)
                        .HasColumnType("character varying(128)")
                        .HasColumnName("correlation_id");

                    b.Property<int>("CriticalDiscrepancyCount")
                        .HasColumnType("integer")
                        .HasColumnName("critical_discrepancy_count");

                    b.Property<string>("ErrorMessage")
                        .HasMaxLength(2000)
                        .HasColumnType("character varying(2000)")
                        .HasColumnName("error_message");

                    b.Property<int>("MajorDiscrepancyCount")
                        .HasColumnType("integer")
                        .HasColumnName("major_discrepancy_count");

                    b.Property<int>("MinorDiscrepancyCount")
                        .HasColumnType("integer")
                        .HasColumnName("minor_discrepancy_count");

                    b.Property<bool>("NightscoutMissing")
                        .HasColumnType("boolean")
                        .HasColumnName("nightscout_missing");

                    b.Property<long?>("NightscoutResponseTimeMs")
                        .HasColumnType("bigint")
                        .HasColumnName("nightscout_response_time_ms");

                    b.Property<int?>("NightscoutStatusCode")
                        .HasColumnType("integer")
                        .HasColumnName("nightscout_status_code");

                    b.Property<bool>("NocturneMissing")
                        .HasColumnType("boolean")
                        .HasColumnName("nocturne_missing");

                    b.Property<long?>("NocturneResponseTimeMs")
                        .HasColumnType("bigint")
                        .HasColumnName("nocturne_response_time_ms");

                    b.Property<int?>("NocturneStatusCode")
                        .HasColumnType("integer")
                        .HasColumnName("nocturne_status_code");

                    b.Property<int>("OverallMatch")
                        .HasColumnType("integer")
                        .HasColumnName("overall_match");

                    b.Property<string>("RequestMethod")
                        .IsRequired()
                        .HasMaxLength(10)
                        .HasColumnType("character varying(10)")
                        .HasColumnName("request_method");

                    b.Property<string>("RequestPath")
                        .IsRequired()
                        .HasMaxLength(2048)
                        .HasColumnType("character varying(2048)")
                        .HasColumnName("request_path");

                    b.Property<string>("SelectedResponseTarget")
                        .HasMaxLength(50)
                        .HasColumnType("character varying(50)")
                        .HasColumnName("selected_response_target");

                    b.Property<string>("SelectionReason")
                        .HasMaxLength(500)
                        .HasColumnType("character varying(500)")
                        .HasColumnName("selection_reason");

                    b.Property<bool>("StatusCodeMatch")
                        .HasColumnType("boolean")
                        .HasColumnName("status_code_match");

                    b.Property<string>("Summary")
                        .IsRequired()
                        .HasMaxLength(1000)
                        .HasColumnType("character varying(1000)")
                        .HasColumnName("summary");

                    b.Property<long>("TotalProcessingTimeMs")
                        .HasColumnType("bigint")
                        .HasColumnName("total_processing_time_ms");

                    b.HasKey("Id");

                    b.HasIndex("AnalysisTimestamp")
                        .IsDescending()
                        .HasDatabaseName("ix_discrepancy_analyses_timestamp");

                    b.HasIndex("CorrelationId")
                        .HasDatabaseName("ix_discrepancy_analyses_correlation_id");

                    b.HasIndex("OverallMatch")
                        .HasDatabaseName("ix_discrepancy_analyses_overall_match");

                    b.HasIndex("RequestPath")
                        .HasDatabaseName("ix_discrepancy_analyses_request_path");

                    b.HasIndex("RequestPath", "AnalysisTimestamp")
                        .IsDescending(false, true)
                        .HasDatabaseName("ix_discrepancy_analyses_path_timestamp");

                    b.ToTable("discrepancy_analyses");
                });

            modelBuilder.Entity("Nocturne.Infrastructure.Data.Entities.DiscrepancyDetailEntity", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid")
                        .HasColumnName("id");

                    b.Property<Guid>("AnalysisId")
                        .HasColumnType("uuid")
                        .HasColumnName("analysis_id");

                    b.Property<string>("Description")
                        .IsRequired()
                        .HasMaxLength(1000)
                        .HasColumnType("character varying(1000)")
                        .HasColumnName("description");

                    b.Property<int>("DiscrepancyType")
                        .HasColumnType("integer")
                        .HasColumnName("discrepancy_type");

                    b.Property<string>("Field")
                        .IsRequired()
                        .HasMaxLength(500)
                        .HasColumnType("character varying(500)")
                        .HasColumnName("field");

                    b.Property<string>("NightscoutValue")
                        .IsRequired()
                        .HasMaxLength(2000)
                        .HasColumnType("character varying(2000)")
                        .HasColumnName("nightscout_value");

                    b.Property<string>("NocturneValue")
                        .IsRequired()
                        .HasMaxLength(2000)
                        .HasColumnType("character varying(2000)")
                        .HasColumnName("nocturne_value");

                    b.Property<DateTimeOffset>("RecordedAt")
                        .HasColumnType("timestamp with time zone")
                        .HasColumnName("recorded_at");

                    b.Property<int>("Severity")
                        .HasColumnType("integer")
                        .HasColumnName("severity");

                    b.HasKey("Id");

                    b.HasIndex("AnalysisId")
                        .HasDatabaseName("ix_discrepancy_details_analysis_id");

                    b.HasIndex("DiscrepancyType")
                        .HasDatabaseName("ix_discrepancy_details_type");

                    b.HasIndex("Severity")
                        .HasDatabaseName("ix_discrepancy_details_severity");

                    b.ToTable("discrepancy_details");
                });

            modelBuilder.Entity("Nocturne.Infrastructure.Data.Entities.EmergencyContactEntity", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("AlertTypes")
                        .IsRequired()
                        .ValueGeneratedOnAdd()
                        .HasColumnType("jsonb")
                        .HasDefaultValue("[]")
                        .HasColumnName("alert_types");

                    b.Property<int>("ContactType")
                        .HasColumnType("integer")
                        .HasColumnName("contact_type");

                    b.Property<DateTime>("CreatedAt")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("timestamp with time zone")
                        .HasColumnName("created_at")
                        .HasDefaultValueSql("CURRENT_TIMESTAMP");

                    b.Property<string>("EmailAddress")
                        .HasMaxLength(255)
                        .HasColumnType("character varying(255)")
                        .HasColumnName("email_address");

                    b.Property<bool>("IsActive")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("boolean")
                        .HasDefaultValue(true)
                        .HasColumnName("is_active");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasMaxLength(255)
                        .HasColumnType("character varying(255)")
                        .HasColumnName("name");

                    b.Property<string>("PhoneNumber")
                        .HasMaxLength(50)
                        .HasColumnType("character varying(50)")
                        .HasColumnName("phone_number");

                    b.Property<int>("Priority")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("integer")
                        .HasDefaultValue(1)
                        .HasColumnName("priority");

                    b.Property<DateTime>("UpdatedAt")
                        .ValueGeneratedOnAddOrUpdate()
                        .HasColumnType("timestamp with time zone")
                        .HasColumnName("updated_at")
                        .HasDefaultValueSql("CURRENT_TIMESTAMP");

                    b.Property<string>("UserId")
                        .IsRequired()
                        .HasMaxLength(255)
                        .HasColumnType("character varying(255)")
                        .HasColumnName("user_id");

                    b.HasKey("Id");

                    b.HasIndex("ContactType")
                        .HasDatabaseName("ix_emergency_contacts_contact_type");

                    b.HasIndex("IsActive")
                        .HasDatabaseName("ix_emergency_contacts_is_active");

                    b.HasIndex("Priority")
                        .HasDatabaseName("ix_emergency_contacts_priority");

                    b.HasIndex("UserId")
                        .HasDatabaseName("ix_emergency_contacts_user_id");

                    b.ToTable("emergency_contacts");
                });

            modelBuilder.Entity("Nocturne.Infrastructure.Data.Entities.EntryEntity", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("AdditionalPropertiesJson")
                        .HasColumnType("jsonb")
                        .HasColumnName("additional_properties");

                    b.Property<string>("CreatedAt")
                        .HasMaxLength(50)
                        .HasColumnType("character varying(50)")
                        .HasColumnName("created_at");

                    b.Property<string>("DataSource")
                        .HasMaxLength(50)
                        .HasColumnType("character varying(50)")
                        .HasColumnName("data_source");

                    b.Property<string>("DateString")
                        .HasMaxLength(50)
                        .HasColumnType("character varying(50)")
                        .HasColumnName("dateString");

                    b.Property<double?>("Delta")
                        .HasColumnType("double precision")
                        .HasColumnName("delta");

                    b.Property<string>("Device")
                        .HasMaxLength(255)
                        .HasColumnType("character varying(255)")
                        .HasColumnName("device");

                    b.Property<string>("Direction")
                        .HasMaxLength(50)
                        .HasColumnType("character varying(50)")
                        .HasColumnName("direction");

                    b.Property<double?>("Filtered")
                        .HasColumnType("double precision")
                        .HasColumnName("filtered");

                    b.Property<double?>("Intercept")
                        .HasColumnType("double precision")
                        .HasColumnName("intercept");

                    b.Property<bool>("IsCalibration")
                        .HasColumnType("boolean")
                        .HasColumnName("is_calibration");

                    b.Property<string>("MetaJson")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("jsonb")
                        .HasDefaultValue("{}")
                        .HasColumnName("meta");

                    b.Property<double>("Mgdl")
                        .HasColumnType("double precision")
                        .HasColumnName("mgdl");

                    b.Property<long>("Mills")
                        .HasColumnType("bigint")
                        .HasColumnName("mills");

                    b.Property<double?>("Mmol")
                        .HasColumnType("double precision")
                        .HasColumnName("mmol");

                    b.Property<DateTime?>("ModifiedAt")
                        .HasColumnType("timestamp with time zone")
                        .HasColumnName("modified_at");

                    b.Property<int?>("Noise")
                        .HasColumnType("integer")
                        .HasColumnName("noise");

                    b.Property<string>("Notes")
                        .HasColumnType("text")
                        .HasColumnName("notes");

                    b.Property<string>("OriginalId")
                        .HasMaxLength(24)
                        .HasColumnType("character varying(24)")
                        .HasColumnName("original_id");

                    b.Property<int?>("Rssi")
                        .HasColumnType("integer")
                        .HasColumnName("rssi");

                    b.Property<double?>("Scale")
                        .HasColumnType("double precision")
                        .HasColumnName("scale");

                    b.Property<string>("ScaledJson")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("jsonb")
                        .HasDefaultValue("null")
                        .HasColumnName("scaled");

                    b.Property<double?>("Sgv")
                        .HasColumnType("double precision")
                        .HasColumnName("sgv");

                    b.Property<double?>("Slope")
                        .HasColumnType("double precision")
                        .HasColumnName("slope");

                    b.Property<DateTime>("SysCreatedAt")
                        .HasColumnType("timestamp with time zone")
                        .HasColumnName("sys_created_at");

                    b.Property<string>("SysTime")
                        .HasMaxLength(50)
                        .HasColumnType("character varying(50)")
                        .HasColumnName("sysTime");

                    b.Property<DateTime>("SysUpdatedAt")
                        .ValueGeneratedOnAddOrUpdate()
                        .HasColumnType("timestamp with time zone")
                        .HasColumnName("sys_updated_at")
                        .HasDefaultValueSql("CURRENT_TIMESTAMP");

                    b.Property<int?>("Trend")
                        .HasColumnType("integer")
                        .HasColumnName("trend");

                    b.Property<double?>("TrendRate")
                        .HasColumnType("double precision")
                        .HasColumnName("trend_rate");

                    b.Property<string>("Type")
                        .IsRequired()
                        .ValueGeneratedOnAdd()
                        .HasMaxLength(50)
                        .HasColumnType("character varying(50)")
                        .HasDefaultValue("sgv")
                        .HasColumnName("type");

                    b.Property<double?>("Unfiltered")
                        .HasColumnType("double precision")
                        .HasColumnName("unfiltered");

                    b.Property<int?>("UtcOffset")
                        .HasColumnType("integer")
                        .HasColumnName("utcOffset");

                    b.HasKey("Id");

                    b.HasIndex("Mills")
                        .IsDescending()
                        .HasDatabaseName("ix_entries_mills");

                    b.HasIndex("SysCreatedAt")
                        .HasDatabaseName("ix_entries_sys_created_at");

                    b.HasIndex("Type")
                        .HasDatabaseName("ix_entries_type");

                    b.HasIndex("Type", "Mills")
                        .IsDescending(false, true)
                        .HasDatabaseName("ix_entries_type_mills");

                    b.HasIndex("Device", "Type", "Sgv", "Mills")
                        .HasDatabaseName("ix_entries_duplicate_detection");

                    b.ToTable("entries");
                });

            modelBuilder.Entity("Nocturne.Infrastructure.Data.Entities.FoodEntity", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("AdditionalPropertiesJson")
                        .HasColumnType("jsonb")
                        .HasColumnName("additional_properties");

                    b.Property<double>("Carbs")
                        .HasColumnType("double precision")
                        .HasColumnName("carbs");

                    b.Property<string>("Category")
                        .IsRequired()
                        .HasMaxLength(200)
                        .HasColumnType("character varying(200)")
                        .HasColumnName("category");

                    b.Property<double>("Energy")
                        .HasColumnType("double precision")
                        .HasColumnName("energy");

                    b.Property<string>("ExternalId")
                        .HasMaxLength(255)
                        .HasColumnType("character varying(255)")
                        .HasColumnName("external_id");

                    b.Property<string>("ExternalSource")
                        .HasMaxLength(50)
                        .HasColumnType("character varying(50)")
                        .HasColumnName("external_source");

                    b.Property<double>("Fat")
                        .HasColumnType("double precision")
                        .HasColumnName("fat");

                    b.Property<string>("Foods")
                        .HasColumnType("text")
                        .HasColumnName("foods");

                    b.Property<int>("Gi")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("integer")
                        .HasDefaultValue(2)
                        .HasColumnName("gi");

                    b.Property<bool>("Hidden")
                        .HasColumnType("boolean")
                        .HasColumnName("hidden");

                    b.Property<bool>("HideAfterUse")
                        .HasColumnType("boolean")
                        .HasColumnName("hide_after_use");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasMaxLength(500)
                        .HasColumnType("character varying(500)")
                        .HasColumnName("name");

                    b.Property<string>("OriginalId")
                        .HasMaxLength(24)
                        .HasColumnType("character varying(24)")
                        .HasColumnName("original_id");

                    b.Property<double>("Portion")
                        .HasColumnType("double precision")
                        .HasColumnName("portion");

                    b.Property<int>("Position")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("integer")
                        .HasDefaultValue(99999)
                        .HasColumnName("position");

                    b.Property<double>("Protein")
                        .HasColumnType("double precision")
                        .HasColumnName("protein");

                    b.Property<string>("Subcategory")
                        .IsRequired()
                        .HasMaxLength(200)
                        .HasColumnType("character varying(200)")
                        .HasColumnName("subcategory");

                    b.Property<DateTime>("SysCreatedAt")
                        .HasColumnType("timestamp with time zone")
                        .HasColumnName("sys_created_at");

                    b.Property<DateTime>("SysUpdatedAt")
                        .ValueGeneratedOnAddOrUpdate()
                        .HasColumnType("timestamp with time zone")
                        .HasColumnName("sys_updated_at")
                        .HasDefaultValueSql("CURRENT_TIMESTAMP");

                    b.Property<string>("Type")
                        .IsRequired()
                        .ValueGeneratedOnAdd()
                        .HasMaxLength(50)
                        .HasColumnType("character varying(50)")
                        .HasDefaultValue("food")
                        .HasColumnName("type");

                    b.Property<string>("Unit")
                        .IsRequired()
                        .ValueGeneratedOnAdd()
                        .HasMaxLength(30)
                        .HasColumnType("character varying(30)")
                        .HasDefaultValue("g")
                        .HasColumnName("unit");

                    b.HasKey("Id");

                    b.HasIndex("Category")
                        .HasDatabaseName("ix_foods_category");

                    b.HasIndex("Name")
                        .HasDatabaseName("ix_foods_name");

                    b.HasIndex("SysCreatedAt")
                        .HasDatabaseName("ix_foods_sys_created_at");

                    b.HasIndex("Type")
                        .HasDatabaseName("ix_foods_type");

                    b.HasIndex("ExternalSource", "ExternalId")
                        .IsUnique()
                        .HasDatabaseName("ix_foods_external_source_id")
                        .HasFilter("external_source IS NOT NULL AND external_id IS NOT NULL");

                    b.HasIndex("Type", "Name")
                        .HasDatabaseName("ix_foods_type_name");

                    b.ToTable("foods");
                });

            modelBuilder.Entity("Nocturne.Infrastructure.Data.Entities.LinkedRecordEntity", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("CanonicalId")
                        .HasColumnType("uuid")
                        .HasColumnName("canonical_id");

                    b.Property<string>("DataSource")
                        .IsRequired()
                        .HasMaxLength(100)
                        .HasColumnType("character varying(100)")
                        .HasColumnName("data_source");

                    b.Property<bool>("IsPrimary")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("boolean")
                        .HasDefaultValue(false)
                        .HasColumnName("is_primary");

                    b.Property<Guid>("RecordId")
                        .HasColumnType("uuid")
                        .HasColumnName("record_id");

                    b.Property<string>("RecordType")
                        .IsRequired()
                        .HasMaxLength(20)
                        .HasColumnType("character varying(20)")
                        .HasColumnName("record_type");

                    b.Property<long>("SourceTimestamp")
                        .HasColumnType("bigint")
                        .HasColumnName("source_timestamp");

                    b.Property<DateTime>("SysCreatedAt")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("timestamp with time zone")
                        .HasColumnName("sys_created_at")
                        .HasDefaultValueSql("CURRENT_TIMESTAMP");

                    b.HasKey("Id");

                    b.HasIndex("CanonicalId")
                        .HasDatabaseName("ix_linked_records_canonical");

                    b.HasIndex("RecordType", "RecordId")
                        .IsUnique()
                        .HasDatabaseName("ix_linked_records_unique");

                    b.HasIndex("RecordType", "SourceTimestamp")
                        .HasDatabaseName("ix_linked_records_type_timestamp");

                    b.HasIndex("RecordType", "CanonicalId", "IsPrimary")
                        .HasDatabaseName("ix_linked_records_type_canonical_primary");

                    b.ToTable("linked_records");
                });

            modelBuilder.Entity("Nocturne.Infrastructure.Data.Entities.LocalUserEntity", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("AdminNotes")
                        .HasColumnType("text")
                        .HasColumnName("admin_notes");

                    b.Property<DateTime>("CreatedAt")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("timestamp with time zone")
                        .HasColumnName("created_at")
                        .HasDefaultValueSql("CURRENT_TIMESTAMP");

                    b.Property<string>("DisplayName")
                        .HasMaxLength(255)
                        .HasColumnType("character varying(255)")
                        .HasColumnName("display_name");

                    b.Property<string>("Email")
                        .IsRequired()
                        .HasMaxLength(255)
                        .HasColumnType("character varying(255)")
                        .HasColumnName("email");

                    b.Property<DateTime?>("EmailVerificationTokenExpiresAt")
                        .HasColumnType("timestamp with time zone")
                        .HasColumnName("email_verification_token_expires_at");

                    b.Property<string>("EmailVerificationTokenHash")
                        .HasMaxLength(64)
                        .HasColumnType("character varying(64)")
                        .HasColumnName("email_verification_token_hash");

                    b.Property<bool>("EmailVerified")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("boolean")
                        .HasDefaultValue(false)
                        .HasColumnName("email_verified");

                    b.Property<int>("FailedLoginAttempts")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("integer")
                        .HasDefaultValue(0)
                        .HasColumnName("failed_login_attempts");

                    b.Property<bool>("IsActive")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("boolean")
                        .HasDefaultValue(true)
                        .HasColumnName("is_active");

                    b.Property<DateTime?>("LastLoginAt")
                        .HasColumnType("timestamp with time zone")
                        .HasColumnName("last_login_at");

                    b.Property<string>("LastLoginIp")
                        .HasMaxLength(45)
                        .HasColumnType("character varying(45)")
                        .HasColumnName("last_login_ip");

                    b.Property<DateTime?>("LockedUntil")
                        .HasColumnType("timestamp with time zone")
                        .HasColumnName("locked_until");

                    b.Property<string>("NormalizedEmail")
                        .IsRequired()
                        .HasMaxLength(255)
                        .HasColumnType("character varying(255)")
                        .HasColumnName("normalized_email");

                    b.Property<DateTime?>("PasswordChangedAt")
                        .HasColumnType("timestamp with time zone")
                        .HasColumnName("password_changed_at");

                    b.Property<string>("PasswordHash")
                        .HasMaxLength(255)
                        .HasColumnType("character varying(255)")
                        .HasColumnName("password_hash");

                    b.Property<DateTime?>("PasswordResetTokenExpiresAt")
                        .HasColumnType("timestamp with time zone")
                        .HasColumnName("password_reset_token_expires_at");

                    b.Property<string>("PasswordResetTokenHash")
                        .HasMaxLength(64)
                        .HasColumnType("character varying(64)")
                        .HasColumnName("password_reset_token_hash");

                    b.Property<bool>("PendingApproval")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("boolean")
                        .HasDefaultValue(false)
                        .HasColumnName("pending_approval");

                    b.Property<bool>("RequirePasswordChange")
                        .HasColumnType("boolean")
                        .HasColumnName("require_password_change");

                    b.Property<Guid?>("SubjectId")
                        .HasColumnType("uuid")
                        .HasColumnName("subject_id");

                    b.Property<DateTime>("UpdatedAt")
                        .ValueGeneratedOnAddOrUpdate()
                        .HasColumnType("timestamp with time zone")
                        .HasColumnName("updated_at")
                        .HasDefaultValueSql("CURRENT_TIMESTAMP");

                    b.HasKey("Id");

                    b.HasIndex("NormalizedEmail")
                        .IsUnique()
                        .HasDatabaseName("ix_local_users_normalized_email");

                    b.HasIndex("SubjectId");

                    b.ToTable("local_users");
                });

            modelBuilder.Entity("Nocturne.Infrastructure.Data.Entities.MigrationRunEntity", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<DateTime?>("CompletedAt")
                        .HasColumnType("timestamp with time zone")
                        .HasColumnName("completed_at");

                    b.Property<DateTime?>("DateRangeEnd")
                        .HasColumnType("timestamp with time zone")
                        .HasColumnName("date_range_end");

                    b.Property<DateTime?>("DateRangeStart")
                        .HasColumnType("timestamp with time zone")
                        .HasColumnName("date_range_start");

                    b.Property<int>("EntriesMigrated")
                        .HasColumnType("integer")
                        .HasColumnName("entries_migrated");

                    b.Property<string>("ErrorMessage")
                        .HasColumnType("text")
                        .HasColumnName("error_message");

                    b.Property<Guid>("SourceId")
                        .HasColumnType("uuid")
                        .HasColumnName("source_id");

                    b.Property<DateTime>("StartedAt")
                        .HasColumnType("timestamp with time zone")
                        .HasColumnName("started_at");

                    b.Property<string>("State")
                        .IsRequired()
                        .HasMaxLength(20)
                        .HasColumnType("character varying(20)")
                        .HasColumnName("state");

                    b.Property<int>("TreatmentsMigrated")
                        .HasColumnType("integer")
                        .HasColumnName("treatments_migrated");

                    b.HasKey("Id");

                    b.HasIndex("SourceId")
                        .HasDatabaseName("ix_migration_runs_source_id");

                    b.HasIndex("StartedAt")
                        .IsDescending()
                        .HasDatabaseName("ix_migration_runs_started_at");

                    b.HasIndex("State")
                        .HasDatabaseName("ix_migration_runs_state");

                    b.HasIndex("SourceId", "State")
                        .HasDatabaseName("ix_migration_runs_source_state");

                    b.ToTable("migration_runs");
                });

            modelBuilder.Entity("Nocturne.Infrastructure.Data.Entities.MigrationSourceEntity", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone")
                        .HasColumnName("created_at");

                    b.Property<DateTime?>("LastMigratedDataTimestamp")
                        .HasColumnType("timestamp with time zone")
                        .HasColumnName("last_migrated_data_timestamp");

                    b.Property<DateTime?>("LastMigrationAt")
                        .HasColumnType("timestamp with time zone")
                        .HasColumnName("last_migration_at");

                    b.Property<string>("Mode")
                        .IsRequired()
                        .HasMaxLength(20)
                        .HasColumnType("character varying(20)")
                        .HasColumnName("mode");

                    b.Property<string>("MongoConnectionStringEncrypted")
                        .HasColumnType("text")
                        .HasColumnName("mongo_connection_string_encrypted");

                    b.Property<string>("MongoDatabaseName")
                        .HasMaxLength(255)
                        .HasColumnType("character varying(255)")
                        .HasColumnName("mongo_database_name");

                    b.Property<string>("NightscoutApiSecretHash")
                        .HasMaxLength(128)
                        .HasColumnType("character varying(128)")
                        .HasColumnName("nightscout_api_secret_hash");

                    b.Property<string>("NightscoutUrl")
                        .HasMaxLength(512)
                        .HasColumnType("character varying(512)")
                        .HasColumnName("nightscout_url");

                    b.Property<string>("SourceIdentifier")
                        .IsRequired()
                        .HasMaxLength(255)
                        .HasColumnType("character varying(255)")
                        .HasColumnName("source_identifier");

                    b.HasKey("Id");

                    b.HasIndex("CreatedAt")
                        .IsDescending()
                        .HasDatabaseName("ix_migration_sources_created_at");

                    b.HasIndex("LastMigrationAt")
                        .HasDatabaseName("ix_migration_sources_last_migration");

                    b.HasIndex("Mode")
                        .HasDatabaseName("ix_migration_sources_mode");

                    b.HasIndex("SourceIdentifier")
                        .IsUnique()
                        .HasDatabaseName("ix_migration_sources_identifier");

                    b.ToTable("migration_sources");
                });

            modelBuilder.Entity("Nocturne.Infrastructure.Data.Entities.NotificationPreferencesEntity", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<int?>("BatteryLowThreshold")
                        .HasColumnType("integer")
                        .HasColumnName("battery_low_threshold");

                    b.Property<int?>("CalibrationReminderHours")
                        .HasColumnType("integer")
                        .HasColumnName("calibration_reminder_hours");

                    b.Property<DateTime>("CreatedAt")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("timestamp with time zone")
                        .HasColumnName("created_at")
                        .HasDefaultValueSql("CURRENT_TIMESTAMP");

                    b.Property<int?>("DataGapWarningMinutes")
                        .HasColumnType("integer")
                        .HasColumnName("data_gap_warning_minutes");

                    b.Property<string>("EmailAddress")
                        .HasMaxLength(255)
                        .HasColumnType("character varying(255)")
                        .HasColumnName("email_address");

                    b.Property<bool>("EmailEnabled")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("boolean")
                        .HasDefaultValue(true)
                        .HasColumnName("email_enabled");

                    b.Property<bool>("EmergencyOverrideQuietHours")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("boolean")
                        .HasDefaultValue(true)
                        .HasColumnName("emergency_override_quiet_hours");

                    b.Property<bool>("PushEnabled")
                        .HasColumnType("boolean")
                        .HasColumnName("push_enabled");

                    b.Property<string>("PushoverDevices")
                        .HasColumnType("jsonb")
                        .HasColumnName("pushover_devices");

                    b.Property<bool>("PushoverEnabled")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("boolean")
                        .HasDefaultValue(false)
                        .HasColumnName("pushover_enabled");

                    b.Property<string>("PushoverUserKey")
                        .HasMaxLength(255)
                        .HasColumnType("character varying(255)")
                        .HasColumnName("pushover_user_key");

                    b.Property<bool>("QuietHoursEnabled")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("boolean")
                        .HasDefaultValue(false)
                        .HasColumnName("quiet_hours_enabled");

                    b.Property<TimeOnly?>("QuietHoursEnd")
                        .HasColumnType("time without time zone")
                        .HasColumnName("quiet_hours_end");

                    b.Property<TimeOnly?>("QuietHoursStart")
                        .HasColumnType("time without time zone")
                        .HasColumnName("quiet_hours_start");

                    b.Property<int?>("SensorExpirationWarningHours")
                        .HasColumnType("integer")
                        .HasColumnName("sensor_expiration_warning_hours");

                    b.Property<bool>("SmsEnabled")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("boolean")
                        .HasDefaultValue(false)
                        .HasColumnName("sms_enabled");

                    b.Property<string>("SmsPhoneNumber")
                        .HasMaxLength(50)
                        .HasColumnType("character varying(50)")
                        .HasColumnName("sms_phone_number");

                    b.Property<DateTime>("UpdatedAt")
                        .ValueGeneratedOnAddOrUpdate()
                        .HasColumnType("timestamp with time zone")
                        .HasColumnName("updated_at")
                        .HasDefaultValueSql("CURRENT_TIMESTAMP");

                    b.Property<string>("UserId")
                        .IsRequired()
                        .HasMaxLength(255)
                        .HasColumnType("character varying(255)")
                        .HasColumnName("user_id");

                    b.Property<bool>("WebhookEnabled")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("boolean")
                        .HasDefaultValue(false)
                        .HasColumnName("webhook_enabled");

                    b.Property<string>("WebhookUrls")
                        .HasColumnType("jsonb")
                        .HasColumnName("webhook_urls");

                    b.HasKey("Id");

                    b.HasIndex("EmailEnabled")
                        .HasDatabaseName("ix_notification_preferences_email_enabled");

                    b.HasIndex("PushoverEnabled")
                        .HasDatabaseName("ix_notification_preferences_pushover_enabled");

                    b.HasIndex("SmsEnabled")
                        .HasDatabaseName("ix_notification_preferences_sms_enabled");

                    b.HasIndex("UserId")
                        .IsUnique()
                        .HasDatabaseName("ix_notification_preferences_user_id");

                    b.ToTable("notification_preferences");
                });

            modelBuilder.Entity("Nocturne.Infrastructure.Data.Entities.OidcProviderEntity", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("ButtonColor")
                        .HasMaxLength(50)
                        .HasColumnType("character varying(50)")
                        .HasColumnName("button_color");

                    b.Property<string>("ClaimMappingsJson")
                        .IsRequired()
                        .ValueGeneratedOnAdd()
                        .HasColumnType("jsonb")
                        .HasDefaultValue("{}")
                        .HasColumnName("claim_mappings");

                    b.Property<string>("ClientId")
                        .IsRequired()
                        .HasMaxLength(255)
                        .HasColumnType("character varying(255)")
                        .HasColumnName("client_id");

                    b.Property<byte[]>("ClientSecretEncrypted")
                        .HasColumnType("bytea")
                        .HasColumnName("client_secret_encrypted");

                    b.Property<DateTime>("CreatedAt")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("timestamp with time zone")
                        .HasColumnName("created_at")
                        .HasDefaultValueSql("CURRENT_TIMESTAMP");

                    b.PrimitiveCollection<string>("DefaultRoles")
                        .IsRequired()
                        .ValueGeneratedOnAdd()
                        .HasColumnType("jsonb")
                        .HasDefaultValue("[\"readable\"]")
                        .HasColumnName("default_roles");

                    b.Property<DateTime?>("DiscoveryCachedAt")
                        .HasColumnType("timestamp with time zone")
                        .HasColumnName("discovery_cached_at");

                    b.Property<string>("DiscoveryDocumentJson")
                        .HasColumnType("jsonb")
                        .HasColumnName("discovery_document");

                    b.Property<int>("DisplayOrder")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("integer")
                        .HasDefaultValue(0)
                        .HasColumnName("display_order");

                    b.Property<string>("Icon")
                        .HasMaxLength(500)
                        .HasColumnType("character varying(500)")
                        .HasColumnName("icon");

                    b.Property<bool>("IsEnabled")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("boolean")
                        .HasDefaultValue(true)
                        .HasColumnName("is_enabled");

                    b.Property<string>("IssuerUrl")
                        .IsRequired()
                        .HasMaxLength(500)
                        .HasColumnType("character varying(500)")
                        .HasColumnName("issuer_url");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasMaxLength(100)
                        .HasColumnType("character varying(100)")
                        .HasColumnName("name");

                    b.PrimitiveCollection<string>("Scopes")
                        .IsRequired()
                        .ValueGeneratedOnAdd()
                        .HasColumnType("jsonb")
                        .HasDefaultValue("[\"openid\",\"profile\",\"email\"]")
                        .HasColumnName("scopes");

                    b.Property<DateTime>("UpdatedAt")
                        .ValueGeneratedOnAddOrUpdate()
                        .HasColumnType("timestamp with time zone")
                        .HasColumnName("updated_at")
                        .HasDefaultValueSql("CURRENT_TIMESTAMP");

                    b.HasKey("Id");

                    b.HasIndex("IsEnabled")
                        .HasDatabaseName("ix_oidc_providers_is_enabled");

                    b.HasIndex("IssuerUrl")
                        .IsUnique()
                        .HasDatabaseName("ix_oidc_providers_issuer_url");

                    b.ToTable("oidc_providers");
                });

            modelBuilder.Entity("Nocturne.Infrastructure.Data.Entities.PasswordResetRequestEntity", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<bool>("AdminNotified")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("boolean")
                        .HasDefaultValue(false)
                        .HasColumnName("admin_notified");

                    b.Property<DateTime>("CreatedAt")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("timestamp with time zone")
                        .HasColumnName("created_at")
                        .HasDefaultValueSql("CURRENT_TIMESTAMP");

                    b.Property<bool>("Handled")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("boolean")
                        .HasDefaultValue(false)
                        .HasColumnName("handled");

                    b.Property<DateTime?>("HandledAt")
                        .HasColumnType("timestamp with time zone")
                        .HasColumnName("handled_at");

                    b.Property<Guid?>("HandledById")
                        .HasColumnType("uuid")
                        .HasColumnName("handled_by_id");

                    b.Property<Guid>("LocalUserId")
                        .HasColumnType("uuid")
                        .HasColumnName("local_user_id");

                    b.Property<string>("RequestedFromIp")
                        .HasMaxLength(45)
                        .HasColumnType("character varying(45)")
                        .HasColumnName("requested_from_ip");

                    b.Property<string>("UserAgent")
                        .HasMaxLength(500)
                        .HasColumnType("character varying(500)")
                        .HasColumnName("user_agent");

                    b.HasKey("Id");

                    b.HasIndex("Handled")
                        .HasDatabaseName("ix_password_reset_requests_pending")
                        .HasFilter("handled = false");

                    b.HasIndex("HandledById");

                    b.HasIndex("LocalUserId");

                    b.ToTable("password_reset_requests");
                });

            modelBuilder.Entity("Nocturne.Infrastructure.Data.Entities.ProfileEntity", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("AdditionalPropertiesJson")
                        .HasColumnType("jsonb")
                        .HasColumnName("additional_properties");

                    b.Property<string>("CreatedAt")
                        .HasMaxLength(50)
                        .HasColumnType("character varying(50)")
                        .HasColumnName("created_at");

                    b.Property<DateTime>("CreatedAtPg")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("timestamp with time zone")
                        .HasColumnName("created_at_pg")
                        .HasDefaultValueSql("CURRENT_TIMESTAMP");

                    b.Property<string>("DefaultProfile")
                        .IsRequired()
                        .ValueGeneratedOnAdd()
                        .HasMaxLength(100)
                        .HasColumnType("character varying(100)")
                        .HasDefaultValue("Default")
                        .HasColumnName("default_profile");

                    b.Property<string>("EnteredBy")
                        .HasMaxLength(100)
                        .HasColumnType("character varying(100)")
                        .HasColumnName("entered_by");

                    b.Property<string>("LoopSettingsJson")
                        .HasColumnType("jsonb")
                        .HasColumnName("loop_settings_json");

                    b.Property<long>("Mills")
                        .HasColumnType("bigint")
                        .HasColumnName("mills");

                    b.Property<string>("OriginalId")
                        .HasMaxLength(24)
                        .HasColumnType("character varying(24)")
                        .HasColumnName("original_id");

                    b.Property<string>("StartDate")
                        .IsRequired()
                        .HasMaxLength(50)
                        .HasColumnType("character varying(50)")
                        .HasColumnName("start_date");

                    b.Property<string>("StoreJson")
                        .IsRequired()
                        .ValueGeneratedOnAdd()
                        .HasColumnType("text")
                        .HasDefaultValue("{}")
                        .HasColumnName("store_json");

                    b.Property<string>("Units")
                        .IsRequired()
                        .ValueGeneratedOnAdd()
                        .HasMaxLength(10)
                        .HasColumnType("character varying(10)")
                        .HasDefaultValue("mg/dl")
                        .HasColumnName("units");

                    b.Property<DateTime>("UpdatedAtPg")
                        .ValueGeneratedOnAddOrUpdate()
                        .HasColumnType("timestamp with time zone")
                        .HasColumnName("updated_at_pg")
                        .HasDefaultValueSql("CURRENT_TIMESTAMP");

                    b.HasKey("Id");

                    b.HasIndex("CreatedAtPg")
                        .HasDatabaseName("ix_profiles_sys_created_at");

                    b.HasIndex("DefaultProfile")
                        .HasDatabaseName("ix_profiles_default_profile");

                    b.HasIndex("Mills")
                        .IsDescending()
                        .HasDatabaseName("ix_profiles_mills");

                    b.HasIndex("Units")
                        .HasDatabaseName("ix_profiles_units");

                    b.ToTable("profiles");
                });

            modelBuilder.Entity("Nocturne.Infrastructure.Data.Entities.RefreshTokenEntity", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("timestamp with time zone")
                        .HasColumnName("created_at")
                        .HasDefaultValueSql("CURRENT_TIMESTAMP");

                    b.Property<string>("DeviceDescription")
                        .HasMaxLength(500)
                        .HasColumnType("character varying(500)")
                        .HasColumnName("device_description");

                    b.Property<DateTime>("ExpiresAt")
                        .HasColumnType("timestamp with time zone")
                        .HasColumnName("expires_at");

                    b.Property<string>("IpAddress")
                        .HasMaxLength(45)
                        .HasColumnType("character varying(45)")
                        .HasColumnName("ip_address");

                    b.Property<DateTime>("IssuedAt")
                        .HasColumnType("timestamp with time zone")
                        .HasColumnName("issued_at");

                    b.Property<DateTime?>("LastUsedAt")
                        .HasColumnType("timestamp with time zone")
                        .HasColumnName("last_used_at");

                    b.Property<string>("OidcSessionId")
                        .HasMaxLength(255)
                        .HasColumnType("character varying(255)")
                        .HasColumnName("oidc_session_id");

                    b.Property<Guid?>("ReplacedByTokenId")
                        .HasColumnType("uuid")
                        .HasColumnName("replaced_by_token_id");

                    b.Property<DateTime?>("RevokedAt")
                        .HasColumnType("timestamp with time zone")
                        .HasColumnName("revoked_at");

                    b.Property<string>("RevokedReason")
                        .HasMaxLength(255)
                        .HasColumnType("character varying(255)")
                        .HasColumnName("revoked_reason");

                    b.Property<Guid>("SubjectId")
                        .HasColumnType("uuid")
                        .HasColumnName("subject_id");

                    b.Property<string>("TokenHash")
                        .IsRequired()
                        .HasMaxLength(64)
                        .HasColumnType("character varying(64)")
                        .HasColumnName("token_hash");

                    b.Property<DateTime>("UpdatedAt")
                        .ValueGeneratedOnAddOrUpdate()
                        .HasColumnType("timestamp with time zone")
                        .HasColumnName("updated_at")
                        .HasDefaultValueSql("CURRENT_TIMESTAMP");

                    b.Property<string>("UserAgent")
                        .HasColumnType("text")
                        .HasColumnName("user_agent");

                    b.HasKey("Id");

                    b.HasIndex("ExpiresAt")
                        .HasDatabaseName("ix_refresh_tokens_expires_at");

                    b.HasIndex("OidcSessionId")
                        .HasDatabaseName("ix_refresh_tokens_oidc_session_id");

                    b.HasIndex("RevokedAt")
                        .HasDatabaseName("ix_refresh_tokens_revoked_at")
                        .HasFilter("revoked_at IS NULL");

                    b.HasIndex("SubjectId")
                        .HasDatabaseName("ix_refresh_tokens_subject_id");

                    b.HasIndex("TokenHash")
                        .IsUnique()
                        .HasDatabaseName("ix_refresh_tokens_token_hash");

                    b.ToTable("refresh_tokens");
                });

            modelBuilder.Entity("Nocturne.Infrastructure.Data.Entities.RoleEntity", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("timestamp with time zone")
                        .HasColumnName("created_at")
                        .HasDefaultValueSql("CURRENT_TIMESTAMP");

                    b.Property<string>("Description")
                        .HasMaxLength(500)
                        .HasColumnType("character varying(500)")
                        .HasColumnName("description");

                    b.Property<bool>("IsSystemRole")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("boolean")
                        .HasDefaultValue(false)
                        .HasColumnName("is_system_role");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasMaxLength(100)
                        .HasColumnType("character varying(100)")
                        .HasColumnName("name");

                    b.Property<string>("Notes")
                        .HasColumnType("text")
                        .HasColumnName("notes");

                    b.Property<string>("OriginalId")
                        .HasMaxLength(24)
                        .HasColumnType("character varying(24)")
                        .HasColumnName("original_id");

                    b.PrimitiveCollection<string>("Permissions")
                        .IsRequired()
                        .ValueGeneratedOnAdd()
                        .HasColumnType("jsonb")
                        .HasDefaultValue("[]")
                        .HasColumnName("permissions");

                    b.Property<DateTime>("UpdatedAt")
                        .ValueGeneratedOnAddOrUpdate()
                        .HasColumnType("timestamp with time zone")
                        .HasColumnName("updated_at")
                        .HasDefaultValueSql("CURRENT_TIMESTAMP");

                    b.HasKey("Id");

                    b.HasIndex("Name")
                        .IsUnique()
                        .HasDatabaseName("ix_roles_name");

                    b.ToTable("roles");
                });

            modelBuilder.Entity("Nocturne.Infrastructure.Data.Entities.SettingsEntity", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("AdditionalPropertiesJson")
                        .HasColumnType("jsonb")
                        .HasColumnName("additional_properties");

                    b.Property<string>("App")
                        .HasMaxLength(200)
                        .HasColumnType("character varying(200)")
                        .HasColumnName("app");

                    b.Property<string>("CreatedAt")
                        .HasMaxLength(50)
                        .HasColumnType("character varying(50)")
                        .HasColumnName("created_at");

                    b.Property<string>("Device")
                        .HasMaxLength(200)
                        .HasColumnType("character varying(200)")
                        .HasColumnName("device");

                    b.Property<string>("EnteredBy")
                        .HasMaxLength(200)
                        .HasColumnType("character varying(200)")
                        .HasColumnName("entered_by");

                    b.Property<bool>("IsActive")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("boolean")
                        .HasDefaultValue(true)
                        .HasColumnName("is_active");

                    b.Property<string>("Key")
                        .IsRequired()
                        .HasMaxLength(500)
                        .HasColumnType("character varying(500)")
                        .HasColumnName("key");

                    b.Property<long>("Mills")
                        .HasColumnType("bigint")
                        .HasColumnName("mills");

                    b.Property<string>("Notes")
                        .HasMaxLength(1000)
                        .HasColumnType("character varying(1000)")
                        .HasColumnName("notes");

                    b.Property<string>("OriginalId")
                        .HasMaxLength(24)
                        .HasColumnType("character varying(24)")
                        .HasColumnName("original_id");

                    b.Property<DateTimeOffset?>("SrvCreated")
                        .HasColumnType("timestamp with time zone")
                        .HasColumnName("srv_created");

                    b.Property<DateTimeOffset?>("SrvModified")
                        .HasColumnType("timestamp with time zone")
                        .HasColumnName("srv_modified");

                    b.Property<DateTime>("SysCreatedAt")
                        .HasColumnType("timestamp with time zone")
                        .HasColumnName("sys_created_at");

                    b.Property<DateTime>("SysUpdatedAt")
                        .ValueGeneratedOnAddOrUpdate()
                        .HasColumnType("timestamp with time zone")
                        .HasColumnName("sys_updated_at")
                        .HasDefaultValueSql("CURRENT_TIMESTAMP");

                    b.Property<int?>("UtcOffset")
                        .HasColumnType("integer")
                        .HasColumnName("utc_offset");

                    b.Property<string>("Value")
                        .HasColumnType("text")
                        .HasColumnName("value");

                    b.Property<int?>("Version")
                        .HasColumnType("integer")
                        .HasColumnName("version");

                    b.HasKey("Id");

                    b.HasIndex("IsActive")
                        .HasDatabaseName("ix_settings_is_active");

                    b.HasIndex("Key")
                        .IsUnique()
                        .HasDatabaseName("ix_settings_key");

                    b.HasIndex("Mills")
                        .IsDescending()
                        .HasDatabaseName("ix_settings_mills");

                    b.HasIndex("SysCreatedAt")
                        .HasDatabaseName("ix_settings_sys_created_at");

                    b.ToTable("settings");
                });

            modelBuilder.Entity("Nocturne.Infrastructure.Data.Entities.StateSpanEntity", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("Category")
                        .IsRequired()
                        .HasMaxLength(50)
                        .HasColumnType("character varying(50)")
                        .HasColumnName("category");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone")
                        .HasColumnName("created_at");

                    b.Property<long?>("EndMills")
                        .HasColumnType("bigint")
                        .HasColumnName("end_mills");

                    b.Property<string>("MetadataJson")
                        .HasColumnType("jsonb")
                        .HasColumnName("metadata");

                    b.Property<string>("OriginalId")
                        .HasMaxLength(255)
                        .HasColumnType("character varying(255)")
                        .HasColumnName("original_id");

                    b.Property<string>("Source")
                        .HasMaxLength(50)
                        .HasColumnType("character varying(50)")
                        .HasColumnName("source");

                    b.Property<long>("StartMills")
                        .HasColumnType("bigint")
                        .HasColumnName("start_mills");

                    b.Property<string>("State")
                        .IsRequired()
                        .HasMaxLength(100)
                        .HasColumnType("character varying(100)")
                        .HasColumnName("state");

                    b.Property<DateTime>("UpdatedAt")
                        .HasColumnType("timestamp with time zone")
                        .HasColumnName("updated_at");

                    b.HasKey("Id");

                    b.HasIndex("Category")
                        .HasDatabaseName("ix_state_spans_category");

                    b.HasIndex("EndMills")
                        .HasDatabaseName("ix_state_spans_end_mills")
                        .HasFilter("end_mills IS NULL");

                    b.HasIndex("OriginalId")
                        .HasDatabaseName("ix_state_spans_original_id");

                    b.HasIndex("Source")
                        .HasDatabaseName("ix_state_spans_source");

                    b.HasIndex("StartMills")
                        .IsDescending()
                        .HasDatabaseName("ix_state_spans_start_mills");

                    b.HasIndex("Category", "StartMills")
                        .IsDescending(false, true)
                        .HasDatabaseName("ix_state_spans_category_start");

                    b.ToTable("state_spans");
                });

            modelBuilder.Entity("Nocturne.Infrastructure.Data.Entities.SubjectEntity", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("AccessTokenHash")
                        .HasMaxLength(64)
                        .HasColumnType("character varying(64)")
                        .HasColumnName("access_token_hash");

                    b.Property<string>("AccessTokenPrefix")
                        .HasMaxLength(50)
                        .HasColumnType("character varying(50)")
                        .HasColumnName("access_token_prefix");

                    b.Property<DateTime>("CreatedAt")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("timestamp with time zone")
                        .HasColumnName("created_at")
                        .HasDefaultValueSql("CURRENT_TIMESTAMP");

                    b.Property<string>("Email")
                        .HasMaxLength(255)
                        .HasColumnType("character varying(255)")
                        .HasColumnName("email");

                    b.Property<bool>("IsActive")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("boolean")
                        .HasDefaultValue(true)
                        .HasColumnName("is_active");

                    b.Property<bool>("IsSystemSubject")
                        .HasColumnType("boolean")
                        .HasColumnName("is_system_subject");

                    b.Property<DateTime?>("LastLoginAt")
                        .HasColumnType("timestamp with time zone")
                        .HasColumnName("last_login_at");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasMaxLength(255)
                        .HasColumnType("character varying(255)")
                        .HasColumnName("name");

                    b.Property<string>("Notes")
                        .HasColumnType("text")
                        .HasColumnName("notes");

                    b.Property<string>("OidcIssuer")
                        .HasMaxLength(500)
                        .HasColumnType("character varying(500)")
                        .HasColumnName("oidc_issuer");

                    b.Property<string>("OidcSubjectId")
                        .HasMaxLength(255)
                        .HasColumnType("character varying(255)")
                        .HasColumnName("oidc_subject_id");

                    b.Property<string>("OriginalId")
                        .HasMaxLength(24)
                        .HasColumnType("character varying(24)")
                        .HasColumnName("original_id");

                    b.Property<string>("PreferredLanguage")
                        .HasMaxLength(10)
                        .HasColumnType("character varying(10)")
                        .HasColumnName("preferred_language");

                    b.Property<DateTime>("UpdatedAt")
                        .ValueGeneratedOnAddOrUpdate()
                        .HasColumnType("timestamp with time zone")
                        .HasColumnName("updated_at")
                        .HasDefaultValueSql("CURRENT_TIMESTAMP");

                    b.HasKey("Id");

                    b.HasIndex("AccessTokenHash")
                        .IsUnique()
                        .HasDatabaseName("ix_subjects_access_token_hash");

                    b.HasIndex("Email")
                        .HasDatabaseName("ix_subjects_email");

                    b.HasIndex("Name")
                        .HasDatabaseName("ix_subjects_name");

                    b.HasIndex("OidcSubjectId", "OidcIssuer")
                        .IsUnique()
                        .HasDatabaseName("ix_subjects_oidc_identity");

                    b.ToTable("subjects");
                });

            modelBuilder.Entity("Nocturne.Infrastructure.Data.Entities.SubjectRoleEntity", b =>
                {
                    b.Property<Guid>("SubjectId")
                        .HasColumnType("uuid")
                        .HasColumnName("subject_id");

                    b.Property<Guid>("RoleId")
                        .HasColumnType("uuid")
                        .HasColumnName("role_id");

                    b.Property<DateTime>("AssignedAt")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("timestamp with time zone")
                        .HasColumnName("assigned_at")
                        .HasDefaultValueSql("CURRENT_TIMESTAMP");

                    b.Property<Guid?>("AssignedById")
                        .HasColumnType("uuid")
                        .HasColumnName("assigned_by_id");

                    b.HasKey("SubjectId", "RoleId");

                    b.HasIndex("AssignedById");

                    b.HasIndex("RoleId");

                    b.ToTable("subject_roles");
                });

            modelBuilder.Entity("Nocturne.Infrastructure.Data.Entities.SystemEventEntity", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<string>("Category")
                        .IsRequired()
                        .HasMaxLength(50)
                        .HasColumnType("character varying(50)")
                        .HasColumnName("category");

                    b.Property<string>("Code")
                        .HasMaxLength(100)
                        .HasColumnType("character varying(100)")
                        .HasColumnName("code");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone")
                        .HasColumnName("created_at");

                    b.Property<string>("Description")
                        .HasMaxLength(1000)
                        .HasColumnType("character varying(1000)")
                        .HasColumnName("description");

                    b.Property<string>("EventType")
                        .IsRequired()
                        .HasMaxLength(50)
                        .HasColumnType("character varying(50)")
                        .HasColumnName("event_type");

                    b.Property<string>("MetadataJson")
                        .HasColumnType("jsonb")
                        .HasColumnName("metadata");

                    b.Property<long>("Mills")
                        .HasColumnType("bigint")
                        .HasColumnName("mills");

                    b.Property<string>("OriginalId")
                        .HasMaxLength(255)
                        .HasColumnType("character varying(255)")
                        .HasColumnName("original_id");

                    b.Property<string>("Source")
                        .HasMaxLength(50)
                        .HasColumnType("character varying(50)")
                        .HasColumnName("source");

                    b.HasKey("Id");

                    b.HasIndex("Category")
                        .HasDatabaseName("ix_system_events_category");

                    b.HasIndex("EventType")
                        .HasDatabaseName("ix_system_events_event_type");

                    b.HasIndex("Mills")
                        .IsDescending()
                        .HasDatabaseName("ix_system_events_mills");

                    b.HasIndex("OriginalId")
                        .HasDatabaseName("ix_system_events_original_id");

                    b.HasIndex("Source")
                        .HasDatabaseName("ix_system_events_source");

                    b.HasIndex("Category", "Mills")
                        .IsDescending(false, true)
                        .HasDatabaseName("ix_system_events_category_mills");

                    b.ToTable("system_events");
                });

            modelBuilder.Entity("Nocturne.Infrastructure.Data.Entities.TrackerDefinitionEntity", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<int>("Category")
                        .HasColumnType("integer")
                        .HasColumnName("category");

                    b.Property<string>("CompletionEventType")
                        .HasMaxLength(100)
                        .HasColumnType("character varying(100)")
                        .HasColumnName("completion_event_type");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone")
                        .HasColumnName("created_at");

                    b.Property<int>("DashboardVisibility")
                        .HasColumnType("integer")
                        .HasColumnName("dashboard_visibility");

                    b.Property<string>("Description")
                        .HasMaxLength(1000)
                        .HasColumnType("character varying(1000)")
                        .HasColumnName("description");

                    b.Property<string>("Icon")
                        .IsRequired()
                        .HasMaxLength(100)
                        .HasColumnType("character varying(100)")
                        .HasColumnName("icon");

                    b.Property<bool>("IsFavorite")
                        .HasColumnType("boolean")
                        .HasColumnName("is_favorite");

                    b.Property<int?>("LifespanHours")
                        .HasColumnType("integer")
                        .HasColumnName("lifespan_hours");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasMaxLength(255)
                        .HasColumnType("character varying(255)")
                        .HasColumnName("name");

                    b.Property<string>("RequiredRoles")
                        .HasColumnType("jsonb")
                        .HasColumnName("required_roles");

                    b.Property<string>("StartEventType")
                        .HasMaxLength(100)
                        .HasColumnType("character varying(100)")
                        .HasColumnName("start_event_type");

                    b.Property<string>("TriggerEventTypes")
                        .IsRequired()
                        .HasColumnType("jsonb")
                        .HasColumnName("trigger_event_types");

                    b.Property<string>("TriggerNotesContains")
                        .HasMaxLength(255)
                        .HasColumnType("character varying(255)")
                        .HasColumnName("trigger_notes_contains");

                    b.Property<DateTime?>("UpdatedAt")
                        .HasColumnType("timestamp with time zone")
                        .HasColumnName("updated_at");

                    b.Property<string>("UserId")
                        .IsRequired()
                        .HasMaxLength(255)
                        .HasColumnType("character varying(255)")
                        .HasColumnName("user_id");

                    b.Property<int>("Visibility")
                        .HasColumnType("integer")
                        .HasColumnName("visibility");

                    b.HasKey("Id");

                    b.HasIndex("CreatedAt")
                        .HasDatabaseName("ix_tracker_definitions_created_at");

                    b.HasIndex("IsFavorite")
                        .HasDatabaseName("ix_tracker_definitions_is_favorite");

                    b.HasIndex("UserId")
                        .HasDatabaseName("ix_tracker_definitions_user_id");

                    b.HasIndex("UserId", "Category")
                        .HasDatabaseName("ix_tracker_definitions_user_category");

                    b.ToTable("tracker_definitions");
                });

            modelBuilder.Entity("Nocturne.Infrastructure.Data.Entities.TrackerInstanceEntity", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<int?>("AckSnoozeMins")
                        .HasColumnType("integer")
                        .HasColumnName("ack_snooze_mins");

                    b.Property<string>("CompleteTreatmentId")
                        .HasMaxLength(255)
                        .HasColumnType("character varying(255)")
                        .HasColumnName("complete_treatment_id");

                    b.Property<DateTime?>("CompletedAt")
                        .HasColumnType("timestamp with time zone")
                        .HasColumnName("completed_at");

                    b.Property<string>("CompletionNotes")
                        .HasMaxLength(1000)
                        .HasColumnType("character varying(1000)")
                        .HasColumnName("completion_notes");

                    b.Property<int?>("CompletionReason")
                        .HasColumnType("integer")
                        .HasColumnName("completion_reason");

                    b.Property<Guid>("DefinitionId")
                        .HasColumnType("uuid")
                        .HasColumnName("definition_id");

                    b.Property<DateTime?>("LastAckedAt")
                        .HasColumnType("timestamp with time zone")
                        .HasColumnName("last_acked_at");

                    b.Property<string>("StartNotes")
                        .HasMaxLength(1000)
                        .HasColumnType("character varying(1000)")
                        .HasColumnName("start_notes");

                    b.Property<string>("StartTreatmentId")
                        .HasMaxLength(255)
                        .HasColumnType("character varying(255)")
                        .HasColumnName("start_treatment_id");

                    b.Property<DateTime>("StartedAt")
                        .HasColumnType("timestamp with time zone")
                        .HasColumnName("started_at");

                    b.Property<string>("UserId")
                        .IsRequired()
                        .HasMaxLength(255)
                        .HasColumnType("character varying(255)")
                        .HasColumnName("user_id");

                    b.HasKey("Id");

                    b.HasIndex("CompletedAt")
                        .HasDatabaseName("ix_tracker_instances_completed_at")
                        .HasFilter("completed_at IS NULL");

                    b.HasIndex("DefinitionId")
                        .HasDatabaseName("ix_tracker_instances_definition_id");

                    b.HasIndex("StartedAt")
                        .IsDescending()
                        .HasDatabaseName("ix_tracker_instances_started_at");

                    b.HasIndex("UserId")
                        .HasDatabaseName("ix_tracker_instances_user_id");

                    b.HasIndex("UserId", "CompletedAt")
                        .HasDatabaseName("ix_tracker_instances_user_completed");

                    b.ToTable("tracker_instances");
                });

            modelBuilder.Entity("Nocturne.Infrastructure.Data.Entities.TrackerNotificationThresholdEntity", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<bool>("AudioEnabled")
                        .HasColumnType("boolean")
                        .HasColumnName("audio_enabled");

                    b.Property<string>("AudioSound")
                        .HasMaxLength(100)
                        .HasColumnType("character varying(100)")
                        .HasColumnName("audio_sound");

                    b.Property<string>("Description")
                        .HasMaxLength(500)
                        .HasColumnType("character varying(500)")
                        .HasColumnName("description");

                    b.Property<int>("DisplayOrder")
                        .HasColumnType("integer")
                        .HasColumnName("display_order");

                    b.Property<int>("Hours")
                        .HasColumnType("integer")
                        .HasColumnName("hours");

                    b.Property<int>("MaxRepeats")
                        .HasColumnType("integer")
                        .HasColumnName("max_repeats");

                    b.Property<bool>("PushEnabled")
                        .HasColumnType("boolean")
                        .HasColumnName("push_enabled");

                    b.Property<int>("RepeatIntervalMins")
                        .HasColumnType("integer")
                        .HasColumnName("repeat_interval_mins");

                    b.Property<bool>("RespectQuietHours")
                        .HasColumnType("boolean")
                        .HasColumnName("respect_quiet_hours");

                    b.Property<Guid>("TrackerDefinitionId")
                        .HasColumnType("uuid")
                        .HasColumnName("tracker_definition_id");

                    b.Property<int>("Urgency")
                        .HasColumnType("integer")
                        .HasColumnName("urgency");

                    b.Property<bool>("VibrateEnabled")
                        .HasColumnType("boolean")
                        .HasColumnName("vibrate_enabled");

                    b.HasKey("Id");

                    b.HasIndex("TrackerDefinitionId")
                        .HasDatabaseName("ix_tracker_notification_thresholds_definition_id");

                    b.HasIndex("TrackerDefinitionId", "DisplayOrder")
                        .HasDatabaseName("ix_tracker_notification_thresholds_def_order");

                    b.ToTable("tracker_notification_thresholds");
                });

            modelBuilder.Entity("Nocturne.Infrastructure.Data.Entities.TrackerPresetEntity", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("timestamp with time zone")
                        .HasColumnName("created_at");

                    b.Property<string>("DefaultStartNotes")
                        .HasMaxLength(1000)
                        .HasColumnType("character varying(1000)")
                        .HasColumnName("default_start_notes");

                    b.Property<Guid>("DefinitionId")
                        .HasColumnType("uuid")
                        .HasColumnName("definition_id");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasMaxLength(255)
                        .HasColumnType("character varying(255)")
                        .HasColumnName("name");

                    b.Property<string>("UserId")
                        .IsRequired()
                        .HasMaxLength(255)
                        .HasColumnType("character varying(255)")
                        .HasColumnName("user_id");

                    b.HasKey("Id");

                    b.HasIndex("DefinitionId")
                        .HasDatabaseName("ix_tracker_presets_definition_id");

                    b.HasIndex("UserId")
                        .HasDatabaseName("ix_tracker_presets_user_id");

                    b.ToTable("tracker_presets");
                });

            modelBuilder.Entity("Nocturne.Infrastructure.Data.Entities.TreatmentEntity", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<double?>("Absolute")
                        .HasColumnType("double precision")
                        .HasColumnName("absolute");

                    b.Property<int?>("AbsorptionTime")
                        .HasColumnType("integer")
                        .HasColumnName("absorptionTime");

                    b.Property<string>("AdditionalPropertiesJson")
                        .HasColumnType("jsonb")
                        .HasColumnName("additional_properties");

                    b.Property<double?>("BloodGlucoseInput")
                        .HasColumnType("double precision")
                        .HasColumnName("blood_glucose_input");

                    b.Property<string>("BloodGlucoseInputSource")
                        .HasMaxLength(50)
                        .HasColumnType("character varying(50)")
                        .HasColumnName("blood_glucose_input_source");

                    b.Property<string>("BolusCalcJson")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("jsonb")
                        .HasDefaultValue("{}")
                        .HasColumnName("boluscalc");

                    b.Property<double?>("CR")
                        .HasColumnType("double precision")
                        .HasColumnName("CR");

                    b.Property<string>("CalculationType")
                        .HasMaxLength(20)
                        .HasColumnType("character varying(20)")
                        .HasColumnName("calculation_type");

                    b.Property<int?>("CarbTime")
                        .HasColumnType("integer")
                        .HasColumnName("carbTime");

                    b.Property<double?>("Carbs")
                        .HasColumnType("double precision")
                        .HasColumnName("carbs");

                    b.Property<bool?>("CircadianPercentageProfile")
                        .HasColumnType("boolean")
                        .HasColumnName("CircadianPercentageProfile");

                    b.Property<string>("Created_at")
                        .HasMaxLength(50)
                        .HasColumnType("character varying(50)")
                        .HasColumnName("created_at");

                    b.Property<string>("CuttedBy")
                        .HasMaxLength(255)
                        .HasColumnType("character varying(255)")
                        .HasColumnName("cuttedby");

                    b.Property<string>("Cutting")
                        .HasMaxLength(255)
                        .HasColumnType("character varying(255)")
                        .HasColumnName("cutting");

                    b.Property<string>("DataSource")
                        .HasMaxLength(50)
                        .HasColumnType("character varying(50)")
                        .HasColumnName("data_source");

                    b.Property<long?>("Date")
                        .HasColumnType("bigint")
                        .HasColumnName("date");

                    b.Property<double?>("Duration")
                        .HasColumnType("double precision")
                        .HasColumnName("duration");

                    b.Property<string>("DurationType")
                        .HasMaxLength(50)
                        .HasColumnType("character varying(50)")
                        .HasColumnName("durationType");

                    b.Property<bool?>("End")
                        .HasColumnType("boolean")
                        .HasColumnName("end");

                    b.Property<long?>("EndMills")
                        .HasColumnType("bigint")
                        .HasColumnName("endmills");

                    b.Property<string>("EndProfile")
                        .HasMaxLength(255)
                        .HasColumnType("character varying(255)")
                        .HasColumnName("endprofile");

                    b.Property<string>("EnteredBy")
                        .HasMaxLength(255)
                        .HasColumnType("character varying(255)")
                        .HasColumnName("enteredBy");

                    b.Property<double?>("EnteredInsulin")
                        .HasColumnType("double precision")
                        .HasColumnName("enteredinsulin");

                    b.Property<string>("EventTime")
                        .HasMaxLength(50)
                        .HasColumnType("character varying(50)")
                        .HasColumnName("eventTime");

                    b.Property<string>("EventType")
                        .HasMaxLength(255)
                        .HasColumnType("character varying(255)")
                        .HasColumnName("eventType");

                    b.Property<double?>("Fat")
                        .HasColumnType("double precision")
                        .HasColumnName("fat");

                    b.Property<bool?>("First")
                        .HasColumnType("boolean")
                        .HasColumnName("first");

                    b.Property<string>("FoodType")
                        .HasMaxLength(255)
                        .HasColumnType("character varying(255)")
                        .HasColumnName("foodType");

                    b.Property<double?>("Glucose")
                        .HasColumnType("double precision")
                        .HasColumnName("glucose");

                    b.Property<string>("GlucoseType")
                        .HasMaxLength(50)
                        .HasColumnType("character varying(50)")
                        .HasColumnName("glucoseType");

                    b.Property<double?>("Insulin")
                        .HasColumnType("double precision")
                        .HasColumnName("insulin");

                    b.Property<double?>("InsulinDelivered")
                        .HasColumnType("double precision")
                        .HasColumnName("insulin_delivered");

                    b.Property<double?>("InsulinNeedsScaleFactor")
                        .HasColumnType("double precision")
                        .HasColumnName("insulinNeedsScaleFactor");

                    b.Property<double?>("InsulinOnBoard")
                        .HasColumnType("double precision")
                        .HasColumnName("insulin_on_board");

                    b.Property<double?>("InsulinProgrammed")
                        .HasColumnType("double precision")
                        .HasColumnName("insulin_programmed");

                    b.Property<double?>("InsulinRecommendationForCarbs")
                        .HasColumnType("double precision")
                        .HasColumnName("insulin_recommendation_for_carbs");

                    b.Property<double?>("InsulinRecommendationForCorrection")
                        .HasColumnType("double precision")
                        .HasColumnName("insulin_recommendation_for_correction");

                    b.Property<bool?>("IsAnnouncement")
                        .HasColumnType("boolean")
                        .HasColumnName("isAnnouncement");

                    b.Property<double?>("Mgdl")
                        .HasColumnType("double precision")
                        .HasColumnName("mgdl");

                    b.Property<long>("Mills")
                        .HasColumnType("bigint")
                        .HasColumnName("mills");

                    b.Property<double?>("Mmol")
                        .HasColumnType("double precision")
                        .HasColumnName("mmol");

                    b.Property<string>("Notes")
                        .HasColumnType("text")
                        .HasColumnName("notes");

                    b.Property<string>("NsClientId")
                        .HasMaxLength(255)
                        .HasColumnType("character varying(255)")
                        .HasColumnName("NSCLIENT_ID");

                    b.Property<string>("OriginalId")
                        .HasMaxLength(24)
                        .HasColumnType("character varying(24)")
                        .HasColumnName("original_id");

                    b.Property<string>("Otp")
                        .HasMaxLength(255)
                        .HasColumnType("character varying(255)")
                        .HasColumnName("otp");

                    b.Property<double?>("Percent")
                        .HasColumnType("double precision")
                        .HasColumnName("percent");

                    b.Property<double?>("Percentage")
                        .HasColumnType("double precision")
                        .HasColumnName("percentage");

                    b.Property<double?>("PreBolus")
                        .HasColumnType("double precision")
                        .HasColumnName("preBolus");

                    b.Property<string>("Profile")
                        .HasMaxLength(255)
                        .HasColumnType("character varying(255)")
                        .HasColumnName("profile");

                    b.Property<string>("ProfileJson")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("jsonb")
                        .HasDefaultValue("null")
                        .HasColumnName("profileJson");

                    b.Property<double?>("Protein")
                        .HasColumnType("double precision")
                        .HasColumnName("protein");

                    b.Property<double?>("Rate")
                        .HasColumnType("double precision")
                        .HasColumnName("rate");

                    b.Property<string>("Reason")
                        .HasColumnType("text")
                        .HasColumnName("reason");

                    b.Property<string>("ReasonDisplay")
                        .HasMaxLength(255)
                        .HasColumnType("character varying(255)")
                        .HasColumnName("reasonDisplay");

                    b.Property<double?>("Relative")
                        .HasColumnType("double precision")
                        .HasColumnName("relative");

                    b.Property<double?>("RemoteAbsorption")
                        .HasColumnType("double precision")
                        .HasColumnName("remoteAbsorption");

                    b.Property<double?>("RemoteBolus")
                        .HasColumnType("double precision")
                        .HasColumnName("remoteBolus");

                    b.Property<double?>("RemoteCarbs")
                        .HasColumnType("double precision")
                        .HasColumnName("remoteCarbs");

                    b.Property<string>("Split")
                        .HasMaxLength(255)
                        .HasColumnType("character varying(255)")
                        .HasColumnName("split");

                    b.Property<double?>("SplitExt")
                        .HasColumnType("double precision")
                        .HasColumnName("splitExt");

                    b.Property<double?>("SplitNow")
                        .HasColumnType("double precision")
                        .HasColumnName("splitNow");

                    b.Property<string>("Status")
                        .HasMaxLength(255)
                        .HasColumnType("character varying(255)")
                        .HasColumnName("status");

                    b.Property<DateTime>("SysCreatedAt")
                        .HasColumnType("timestamp with time zone")
                        .HasColumnName("sys_created_at");

                    b.Property<DateTime>("SysUpdatedAt")
                        .ValueGeneratedOnAddOrUpdate()
                        .HasColumnType("timestamp with time zone")
                        .HasColumnName("sys_updated_at")
                        .HasDefaultValueSql("CURRENT_TIMESTAMP");

                    b.Property<double?>("TargetBottom")
                        .HasColumnType("double precision")
                        .HasColumnName("targetBottom");

                    b.Property<double?>("TargetTop")
                        .HasColumnType("double precision")
                        .HasColumnName("targetTop");

                    b.Property<double?>("Timeshift")
                        .HasColumnType("double precision")
                        .HasColumnName("timeshift");

                    b.Property<long?>("Timestamp")
                        .HasColumnType("bigint")
                        .HasColumnName("timestamp");

                    b.Property<string>("TransmitterId")
                        .HasMaxLength(255)
                        .HasColumnType("character varying(255)")
                        .HasColumnName("transmitterId");

                    b.Property<string>("Units")
                        .HasMaxLength(10)
                        .HasColumnType("character varying(10)")
                        .HasColumnName("units");

                    b.Property<int?>("UtcOffset")
                        .HasColumnType("integer")
                        .HasColumnName("utcOffset");

                    b.HasKey("Id");

                    b.HasIndex("EventType")
                        .HasDatabaseName("ix_treatments_event_type");

                    b.HasIndex("Mills")
                        .IsDescending()
                        .HasDatabaseName("ix_treatments_mills");

                    b.HasIndex("SysCreatedAt")
                        .HasDatabaseName("ix_treatments_sys_created_at");

                    b.HasIndex("EventType", "Mills")
                        .IsDescending(false, true)
                        .HasDatabaseName("ix_treatments_event_type_mills");

                    b.ToTable("treatments");
                });

            modelBuilder.Entity("Nocturne.Infrastructure.Data.Entities.TreatmentFoodEntity", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<decimal>("Carbs")
                        .HasColumnType("numeric")
                        .HasColumnName("carbs");

                    b.Property<Guid?>("FoodId")
                        .HasColumnType("uuid")
                        .HasColumnName("food_id");

                    b.Property<string>("Note")
                        .HasMaxLength(1000)
                        .HasColumnType("character varying(1000)")
                        .HasColumnName("note");

                    b.Property<decimal>("Portions")
                        .HasColumnType("numeric")
                        .HasColumnName("portions");

                    b.Property<DateTime>("SysCreatedAt")
                        .HasColumnType("timestamp with time zone")
                        .HasColumnName("sys_created_at");

                    b.Property<DateTime>("SysUpdatedAt")
                        .ValueGeneratedOnAddOrUpdate()
                        .HasColumnType("timestamp with time zone")
                        .HasColumnName("sys_updated_at")
                        .HasDefaultValueSql("CURRENT_TIMESTAMP");

                    b.Property<int>("TimeOffsetMinutes")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("integer")
                        .HasDefaultValue(0)
                        .HasColumnName("time_offset_minutes");

                    b.Property<Guid>("TreatmentId")
                        .HasColumnType("uuid")
                        .HasColumnName("treatment_id");

                    b.HasKey("Id");

                    b.HasIndex("FoodId")
                        .HasDatabaseName("ix_treatment_foods_food_id");

                    b.HasIndex("SysCreatedAt")
                        .HasDatabaseName("ix_treatment_foods_sys_created_at");

                    b.HasIndex("TreatmentId")
                        .HasDatabaseName("ix_treatment_foods_treatment_id");

                    b.ToTable("treatment_foods");
                });

            modelBuilder.Entity("Nocturne.Infrastructure.Data.Entities.UserFoodFavoriteEntity", b =>
                {
                    b.Property<Guid>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("uuid");

                    b.Property<Guid>("FoodId")
                        .HasColumnType("uuid")
                        .HasColumnName("food_id");

                    b.Property<DateTime>("SysCreatedAt")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("timestamp with time zone")
                        .HasColumnName("sys_created_at")
                        .HasDefaultValueSql("CURRENT_TIMESTAMP");

                    b.Property<string>("UserId")
                        .IsRequired()
                        .HasMaxLength(255)
                        .HasColumnType("character varying(255)")
                        .HasColumnName("user_id");

                    b.HasKey("Id");

                    b.HasIndex("FoodId")
                        .HasDatabaseName("ix_user_food_favorites_food_id");

                    b.HasIndex("UserId")
                        .HasDatabaseName("ix_user_food_favorites_user_id");

                    b.HasIndex("UserId", "FoodId")
                        .IsUnique()
                        .HasDatabaseName("ix_user_food_favorites_user_food");

                    b.ToTable("user_food_favorites");
                });

            modelBuilder.Entity("Nocturne.Infrastructure.Data.Entities.AlertHistoryEntity", b =>
                {
                    b.HasOne("Nocturne.Infrastructure.Data.Entities.AlertRuleEntity", "AlertRule")
                        .WithMany("AlertHistory")
                        .HasForeignKey("AlertRuleId");

                    b.Navigation("AlertRule");
                });

            modelBuilder.Entity("Nocturne.Infrastructure.Data.Entities.AuthAuditLogEntity", b =>
                {
                    b.HasOne("Nocturne.Infrastructure.Data.Entities.RefreshTokenEntity", "RefreshToken")
                        .WithMany()
                        .HasForeignKey("RefreshTokenId")
                        .OnDelete(DeleteBehavior.SetNull);

                    b.HasOne("Nocturne.Infrastructure.Data.Entities.SubjectEntity", "Subject")
                        .WithMany()
                        .HasForeignKey("SubjectId")
                        .OnDelete(DeleteBehavior.SetNull);

                    b.Navigation("RefreshToken");

                    b.Navigation("Subject");
                });

            modelBuilder.Entity("Nocturne.Infrastructure.Data.Entities.ConnectorFoodEntryEntity", b =>
                {
                    b.HasOne("Nocturne.Infrastructure.Data.Entities.FoodEntity", "Food")
                        .WithMany()
                        .HasForeignKey("FoodId")
                        .OnDelete(DeleteBehavior.SetNull);

                    b.HasOne("Nocturne.Infrastructure.Data.Entities.TreatmentEntity", "MatchedTreatment")
                        .WithMany()
                        .HasForeignKey("MatchedTreatmentId")
                        .OnDelete(DeleteBehavior.SetNull);

                    b.Navigation("Food");

                    b.Navigation("MatchedTreatment");
                });

            modelBuilder.Entity("Nocturne.Infrastructure.Data.Entities.DiscrepancyDetailEntity", b =>
                {
                    b.HasOne("Nocturne.Infrastructure.Data.Entities.DiscrepancyAnalysisEntity", "Analysis")
                        .WithMany("Discrepancies")
                        .HasForeignKey("AnalysisId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Analysis");
                });

            modelBuilder.Entity("Nocturne.Infrastructure.Data.Entities.LocalUserEntity", b =>
                {
                    b.HasOne("Nocturne.Infrastructure.Data.Entities.SubjectEntity", "Subject")
                        .WithMany()
                        .HasForeignKey("SubjectId")
                        .OnDelete(DeleteBehavior.SetNull);

                    b.Navigation("Subject");
                });

            modelBuilder.Entity("Nocturne.Infrastructure.Data.Entities.MigrationRunEntity", b =>
                {
                    b.HasOne("Nocturne.Infrastructure.Data.Entities.MigrationSourceEntity", "Source")
                        .WithMany("Runs")
                        .HasForeignKey("SourceId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Source");
                });

            modelBuilder.Entity("Nocturne.Infrastructure.Data.Entities.PasswordResetRequestEntity", b =>
                {
                    b.HasOne("Nocturne.Infrastructure.Data.Entities.SubjectEntity", "HandledBy")
                        .WithMany()
                        .HasForeignKey("HandledById")
                        .OnDelete(DeleteBehavior.SetNull);

                    b.HasOne("Nocturne.Infrastructure.Data.Entities.LocalUserEntity", "LocalUser")
                        .WithMany()
                        .HasForeignKey("LocalUserId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("HandledBy");

                    b.Navigation("LocalUser");
                });

            modelBuilder.Entity("Nocturne.Infrastructure.Data.Entities.RefreshTokenEntity", b =>
                {
                    b.HasOne("Nocturne.Infrastructure.Data.Entities.SubjectEntity", "Subject")
                        .WithMany("RefreshTokens")
                        .HasForeignKey("SubjectId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Subject");
                });

            modelBuilder.Entity("Nocturne.Infrastructure.Data.Entities.SubjectRoleEntity", b =>
                {
                    b.HasOne("Nocturne.Infrastructure.Data.Entities.SubjectEntity", "AssignedBy")
                        .WithMany()
                        .HasForeignKey("AssignedById")
                        .OnDelete(DeleteBehavior.SetNull);

                    b.HasOne("Nocturne.Infrastructure.Data.Entities.RoleEntity", "Role")
                        .WithMany("SubjectRoles")
                        .HasForeignKey("RoleId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("Nocturne.Infrastructure.Data.Entities.SubjectEntity", "Subject")
                        .WithMany("SubjectRoles")
                        .HasForeignKey("SubjectId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("AssignedBy");

                    b.Navigation("Role");

                    b.Navigation("Subject");
                });

            modelBuilder.Entity("Nocturne.Infrastructure.Data.Entities.TrackerInstanceEntity", b =>
                {
                    b.HasOne("Nocturne.Infrastructure.Data.Entities.TrackerDefinitionEntity", "Definition")
                        .WithMany("Instances")
                        .HasForeignKey("DefinitionId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Definition");
                });

            modelBuilder.Entity("Nocturne.Infrastructure.Data.Entities.TrackerNotificationThresholdEntity", b =>
                {
                    b.HasOne("Nocturne.Infrastructure.Data.Entities.TrackerDefinitionEntity", "Definition")
                        .WithMany("NotificationThresholds")
                        .HasForeignKey("TrackerDefinitionId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Definition");
                });

            modelBuilder.Entity("Nocturne.Infrastructure.Data.Entities.TrackerPresetEntity", b =>
                {
                    b.HasOne("Nocturne.Infrastructure.Data.Entities.TrackerDefinitionEntity", "Definition")
                        .WithMany("Presets")
                        .HasForeignKey("DefinitionId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Definition");
                });

            modelBuilder.Entity("Nocturne.Infrastructure.Data.Entities.TreatmentFoodEntity", b =>
                {
                    b.HasOne("Nocturne.Infrastructure.Data.Entities.FoodEntity", "Food")
                        .WithMany()
                        .HasForeignKey("FoodId")
                        .OnDelete(DeleteBehavior.SetNull);

                    b.HasOne("Nocturne.Infrastructure.Data.Entities.TreatmentEntity", "Treatment")
                        .WithMany()
                        .HasForeignKey("TreatmentId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Food");

                    b.Navigation("Treatment");
                });

            modelBuilder.Entity("Nocturne.Infrastructure.Data.Entities.UserFoodFavoriteEntity", b =>
                {
                    b.HasOne("Nocturne.Infrastructure.Data.Entities.FoodEntity", "Food")
                        .WithMany()
                        .HasForeignKey("FoodId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Food");
                });

            modelBuilder.Entity("Nocturne.Infrastructure.Data.Entities.AlertRuleEntity", b =>
                {
                    b.Navigation("AlertHistory");
                });

            modelBuilder.Entity("Nocturne.Infrastructure.Data.Entities.DiscrepancyAnalysisEntity", b =>
                {
                    b.Navigation("Discrepancies");
                });

            modelBuilder.Entity("Nocturne.Infrastructure.Data.Entities.MigrationSourceEntity", b =>
                {
                    b.Navigation("Runs");
                });

            modelBuilder.Entity("Nocturne.Infrastructure.Data.Entities.RoleEntity", b =>
                {
                    b.Navigation("SubjectRoles");
                });

            modelBuilder.Entity("Nocturne.Infrastructure.Data.Entities.SubjectEntity", b =>
                {
                    b.Navigation("RefreshTokens");

                    b.Navigation("SubjectRoles");
                });

            modelBuilder.Entity("Nocturne.Infrastructure.Data.Entities.TrackerDefinitionEntity", b =>
                {
                    b.Navigation("Instances");

                    b.Navigation("NotificationThresholds");

                    b.Navigation("Presets");
                });
#pragma warning restore 612, 618
        }
    }
}
